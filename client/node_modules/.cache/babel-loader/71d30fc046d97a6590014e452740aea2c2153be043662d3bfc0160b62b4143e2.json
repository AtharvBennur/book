{"ast":null,"code":"import{useMemo,useState}from'react';import{useNavigate}from'react-router-dom';import BookFilters from'../components/books/BookFilters';import BookGrid from'../components/books/BookGrid';import SectionHeading from'../components/common/SectionHeading';import{useAppData}from'../context/AppDataContext';import{useAuth}from'../context/AuthContext';import{exchangesApi,conversationsApi}from'../services/api';import{useNotification}from'../context/NotificationContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Browse=()=>{const{books,booksStatus,favorites,toggleFavorite,refreshBooks,refreshExchanges,isOwner,exchanges}=useAppData();const{isAuthenticated,token,user}=useAuth();const{notify}=useNotification();const navigate=useNavigate();const[filters,setFilters]=useState({search:'',genre:'All Genres',status:'Any Status'});const filteredBooks=useMemo(()=>{return books.filter(book=>{const matchesSearch=!filters.search||book.title.toLowerCase().includes(filters.search.toLowerCase())||book.author.toLowerCase().includes(filters.search.toLowerCase());const matchesGenre=filters.genre==='All Genres'||book.genre===filters.genre;const matchesStatus=filters.status==='Any Status'||book.status===filters.status;return matchesSearch&&matchesGenre&&matchesStatus;});},[books,filters]);const requireAuth=()=>{if(!isAuthenticated){notify('Please sign in to continue.','info');navigate('/auth/signin',{replace:true,state:{from:'/browse'}});return false;}return true;};const handleRequest=async book=>{if(!requireAuth())return;try{await exchangesApi.create({bookId:book.id,message:\"I'd love to exchange for \".concat(book.title)},token);notify('Exchange request sent.','success');refreshBooks();refreshExchanges();}catch(err){notify(err.message||'Unable to create request.','error');}};const canChatOnBook=book=>{if(!user)return false;return exchanges.some(exchange=>exchange.bookId===book.id&&[exchange.ownerId,exchange.requesterId].includes(user.id)&&[exchange.ownerId,exchange.requesterId].includes(book.ownerId));};const handleChat=async book=>{if(!requireAuth())return;if(!canChatOnBook(book)){notify('Send or accept an exchange request to unlock chat for this book.','info');return;}try{const conversation=await conversationsApi.create({otherUserId:book.ownerId,bookId:book.id},token);navigate('/chat',{state:{conversationId:conversation.id}});}catch(err){notify(err.message||'Unable to open chat.','error');}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(SectionHeading,{eyebrow:\"Browse\",title:\"Seamless marketplace for every genre\",description:\"Use filters, favorites, and quick actions to find the exact story you want to read next.\",align:\"left\"}),/*#__PURE__*/_jsx(BookFilters,{filters:filters,onChange:setFilters}),/*#__PURE__*/_jsx(BookGrid,{books:filteredBooks,isLoading:booksStatus==='loading',favorites:favorites,onToggleFavorite:isAuthenticated?toggleFavorite:undefined,onRequestExchange:handleRequest,onChat:handleChat,isOwner:isOwner})]});};export default Browse;","map":{"version":3,"names":["useMemo","useState","useNavigate","BookFilters","BookGrid","SectionHeading","useAppData","useAuth","exchangesApi","conversationsApi","useNotification","jsx","_jsx","jsxs","_jsxs","Browse","books","booksStatus","favorites","toggleFavorite","refreshBooks","refreshExchanges","isOwner","exchanges","isAuthenticated","token","user","notify","navigate","filters","setFilters","search","genre","status","filteredBooks","filter","book","matchesSearch","title","toLowerCase","includes","author","matchesGenre","matchesStatus","requireAuth","replace","state","from","handleRequest","create","bookId","id","message","concat","err","canChatOnBook","some","exchange","ownerId","requesterId","handleChat","conversation","otherUserId","conversationId","children","eyebrow","description","align","onChange","isLoading","onToggleFavorite","undefined","onRequestExchange","onChat"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/pages/Browse.jsx"],"sourcesContent":["import { useMemo, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport BookFilters from '../components/books/BookFilters';\r\nimport BookGrid from '../components/books/BookGrid';\r\nimport SectionHeading from '../components/common/SectionHeading';\r\nimport { useAppData } from '../context/AppDataContext';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { exchangesApi, conversationsApi } from '../services/api';\r\nimport { useNotification } from '../context/NotificationContext';\r\n\r\nconst Browse = () => {\r\n  const {\r\n    books,\r\n    booksStatus,\r\n    favorites,\r\n    toggleFavorite,\r\n    refreshBooks,\r\n    refreshExchanges,\r\n    isOwner,\r\n    exchanges,\r\n  } = useAppData();\r\n  const { isAuthenticated, token, user } = useAuth();\r\n  const { notify } = useNotification();\r\n  const navigate = useNavigate();\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    genre: 'All Genres',\r\n    status: 'Any Status',\r\n  });\r\n\r\n  const filteredBooks = useMemo(() => {\r\n    return books.filter((book) => {\r\n      const matchesSearch =\r\n        !filters.search ||\r\n        book.title.toLowerCase().includes(filters.search.toLowerCase()) ||\r\n        book.author.toLowerCase().includes(filters.search.toLowerCase());\r\n      const matchesGenre = filters.genre === 'All Genres' || book.genre === filters.genre;\r\n      const matchesStatus = filters.status === 'Any Status' || book.status === filters.status;\r\n      return matchesSearch && matchesGenre && matchesStatus;\r\n    });\r\n  }, [books, filters]);\r\n\r\n  const requireAuth = () => {\r\n    if (!isAuthenticated) {\r\n      notify('Please sign in to continue.', 'info');\r\n      navigate('/auth/signin', { replace: true, state: { from: '/browse' } });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleRequest = async (book) => {\r\n    if (!requireAuth()) return;\r\n    try {\r\n      await exchangesApi.create(\r\n        { bookId: book.id, message: `I'd love to exchange for ${book.title}` },\r\n        token\r\n      );\r\n      notify('Exchange request sent.', 'success');\r\n      refreshBooks();\r\n      refreshExchanges();\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to create request.', 'error');\r\n    }\r\n  };\r\n\r\n  const canChatOnBook = (book) => {\r\n    if (!user) return false;\r\n    return exchanges.some(\r\n      (exchange) =>\r\n        exchange.bookId === book.id &&\r\n        [exchange.ownerId, exchange.requesterId].includes(user.id) &&\r\n        [exchange.ownerId, exchange.requesterId].includes(book.ownerId)\r\n    );\r\n  };\r\n\r\n  const handleChat = async (book) => {\r\n    if (!requireAuth()) return;\r\n    if (!canChatOnBook(book)) {\r\n      notify('Send or accept an exchange request to unlock chat for this book.', 'info');\r\n      return;\r\n    }\r\n    try {\r\n      const conversation = await conversationsApi.create(\r\n        { otherUserId: book.ownerId, bookId: book.id },\r\n        token\r\n      );\r\n      navigate('/chat', { state: { conversationId: conversation.id } });\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to open chat.', 'error');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <SectionHeading\r\n        eyebrow=\"Browse\"\r\n        title=\"Seamless marketplace for every genre\"\r\n        description=\"Use filters, favorites, and quick actions to find the exact story you want to read next.\"\r\n        align=\"left\"\r\n      />\r\n      <BookFilters filters={filters} onChange={setFilters} />\r\n      <BookGrid\r\n        books={filteredBooks}\r\n        isLoading={booksStatus === 'loading'}\r\n        favorites={favorites}\r\n        onToggleFavorite={isAuthenticated ? toggleFavorite : undefined}\r\n        onRequestExchange={handleRequest}\r\n        onChat={handleChat}\r\n        isOwner={isOwner}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Browse;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}