{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\dell\\\\Desktop\\\\pro\\\\book-exchange-app\\\\client\\\\src\\\\pages\\\\Browse.jsx\",\n  _s = $RefreshSig$();\nimport { useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport BookFilters from '../components/books/BookFilters';\nimport BookGrid from '../components/books/BookGrid';\nimport SectionHeading from '../components/common/SectionHeading';\nimport { useAppData } from '../context/AppDataContext';\nimport { useAuth } from '../context/AuthContext';\nimport { exchangesApi, conversationsApi } from '../services/api';\nimport { useNotification } from '../context/NotificationContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Browse = () => {\n  _s();\n  const {\n    books,\n    booksStatus,\n    favorites,\n    toggleFavorite,\n    refreshBooks,\n    refreshExchanges,\n    isOwner,\n    exchanges\n  } = useAppData();\n  const {\n    isAuthenticated,\n    token,\n    user\n  } = useAuth();\n  const {\n    notify\n  } = useNotification();\n  const navigate = useNavigate();\n  const [filters, setFilters] = useState({\n    search: '',\n    genre: 'All Genres',\n    status: 'Any Status'\n  });\n  const filteredBooks = useMemo(() => {\n    return books.filter(book => {\n      const matchesSearch = !filters.search || book.title.toLowerCase().includes(filters.search.toLowerCase()) || book.author.toLowerCase().includes(filters.search.toLowerCase());\n      const matchesGenre = filters.genre === 'All Genres' || book.genre === filters.genre;\n      const matchesStatus = filters.status === 'Any Status' || book.status === filters.status;\n      return matchesSearch && matchesGenre && matchesStatus;\n    });\n  }, [books, filters]);\n  const requireAuth = () => {\n    if (!isAuthenticated) {\n      notify('Please sign in to continue.', 'info');\n      navigate('/auth/signin', {\n        replace: true,\n        state: {\n          from: '/browse'\n        }\n      });\n      return false;\n    }\n    return true;\n  };\n  const handleRequest = async book => {\n    if (!requireAuth()) return;\n    try {\n      await exchangesApi.create({\n        bookId: book.id,\n        message: `I'd love to exchange for ${book.title}`\n      }, token);\n      notify('Exchange request sent.', 'success');\n      refreshBooks();\n      refreshExchanges();\n    } catch (err) {\n      notify(err.message || 'Unable to create request.', 'error');\n    }\n  };\n  const canChatOnBook = book => {\n    if (!user) return false;\n    return exchanges.some(exchange => exchange.bookId === book.id && [exchange.ownerId, exchange.requesterId].includes(user.id) && [exchange.ownerId, exchange.requesterId].includes(book.ownerId));\n  };\n  const handleChat = async book => {\n    if (!requireAuth()) return;\n    if (!canChatOnBook(book)) {\n      notify('Send or accept an exchange request to unlock chat for this book.', 'info');\n      return;\n    }\n    try {\n      const conversation = await conversationsApi.create({\n        otherUserId: book.ownerId,\n        bookId: book.id\n      }, token);\n      navigate('/chat', {\n        state: {\n          conversationId: conversation.id\n        }\n      });\n    } catch (err) {\n      notify(err.message || 'Unable to open chat.', 'error');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(SectionHeading, {\n      eyebrow: \"Browse\",\n      title: \"Seamless marketplace for every genre\",\n      description: \"Use filters, favorites, and quick actions to find the exact story you want to read next.\",\n      align: \"left\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(BookFilters, {\n      filters: filters,\n      onChange: setFilters\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(BookGrid, {\n      books: filteredBooks,\n      isLoading: booksStatus === 'loading',\n      favorites: favorites,\n      onToggleFavorite: isAuthenticated ? toggleFavorite : undefined,\n      onRequestExchange: handleRequest,\n      onChat: handleChat,\n      isOwner: isOwner\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n};\n_s(Browse, \"baaCp0LhfSgph9WHV9WL2KuKZ/4=\", false, function () {\n  return [useAppData, useAuth, useNotification, useNavigate];\n});\n_c = Browse;\nexport default Browse;\nvar _c;\n$RefreshReg$(_c, \"Browse\");","map":{"version":3,"names":["useMemo","useState","useNavigate","BookFilters","BookGrid","SectionHeading","useAppData","useAuth","exchangesApi","conversationsApi","useNotification","jsxDEV","_jsxDEV","Browse","_s","books","booksStatus","favorites","toggleFavorite","refreshBooks","refreshExchanges","isOwner","exchanges","isAuthenticated","token","user","notify","navigate","filters","setFilters","search","genre","status","filteredBooks","filter","book","matchesSearch","title","toLowerCase","includes","author","matchesGenre","matchesStatus","requireAuth","replace","state","from","handleRequest","create","bookId","id","message","err","canChatOnBook","some","exchange","ownerId","requesterId","handleChat","conversation","otherUserId","conversationId","children","eyebrow","description","align","fileName","_jsxFileName","lineNumber","columnNumber","onChange","isLoading","onToggleFavorite","undefined","onRequestExchange","onChat","_c","$RefreshReg$"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/pages/Browse.jsx"],"sourcesContent":["import { useMemo, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport BookFilters from '../components/books/BookFilters';\r\nimport BookGrid from '../components/books/BookGrid';\r\nimport SectionHeading from '../components/common/SectionHeading';\r\nimport { useAppData } from '../context/AppDataContext';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { exchangesApi, conversationsApi } from '../services/api';\r\nimport { useNotification } from '../context/NotificationContext';\r\n\r\nconst Browse = () => {\r\n  const {\r\n    books,\r\n    booksStatus,\r\n    favorites,\r\n    toggleFavorite,\r\n    refreshBooks,\r\n    refreshExchanges,\r\n    isOwner,\r\n    exchanges,\r\n  } = useAppData();\r\n  const { isAuthenticated, token, user } = useAuth();\r\n  const { notify } = useNotification();\r\n  const navigate = useNavigate();\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    genre: 'All Genres',\r\n    status: 'Any Status',\r\n  });\r\n\r\n  const filteredBooks = useMemo(() => {\r\n    return books.filter((book) => {\r\n      const matchesSearch =\r\n        !filters.search ||\r\n        book.title.toLowerCase().includes(filters.search.toLowerCase()) ||\r\n        book.author.toLowerCase().includes(filters.search.toLowerCase());\r\n      const matchesGenre = filters.genre === 'All Genres' || book.genre === filters.genre;\r\n      const matchesStatus = filters.status === 'Any Status' || book.status === filters.status;\r\n      return matchesSearch && matchesGenre && matchesStatus;\r\n    });\r\n  }, [books, filters]);\r\n\r\n  const requireAuth = () => {\r\n    if (!isAuthenticated) {\r\n      notify('Please sign in to continue.', 'info');\r\n      navigate('/auth/signin', { replace: true, state: { from: '/browse' } });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleRequest = async (book) => {\r\n    if (!requireAuth()) return;\r\n    try {\r\n      await exchangesApi.create(\r\n        { bookId: book.id, message: `I'd love to exchange for ${book.title}` },\r\n        token\r\n      );\r\n      notify('Exchange request sent.', 'success');\r\n      refreshBooks();\r\n      refreshExchanges();\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to create request.', 'error');\r\n    }\r\n  };\r\n\r\n  const canChatOnBook = (book) => {\r\n    if (!user) return false;\r\n    return exchanges.some(\r\n      (exchange) =>\r\n        exchange.bookId === book.id &&\r\n        [exchange.ownerId, exchange.requesterId].includes(user.id) &&\r\n        [exchange.ownerId, exchange.requesterId].includes(book.ownerId)\r\n    );\r\n  };\r\n\r\n  const handleChat = async (book) => {\r\n    if (!requireAuth()) return;\r\n    if (!canChatOnBook(book)) {\r\n      notify('Send or accept an exchange request to unlock chat for this book.', 'info');\r\n      return;\r\n    }\r\n    try {\r\n      const conversation = await conversationsApi.create(\r\n        { otherUserId: book.ownerId, bookId: book.id },\r\n        token\r\n      );\r\n      navigate('/chat', { state: { conversationId: conversation.id } });\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to open chat.', 'error');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <SectionHeading\r\n        eyebrow=\"Browse\"\r\n        title=\"Seamless marketplace for every genre\"\r\n        description=\"Use filters, favorites, and quick actions to find the exact story you want to read next.\"\r\n        align=\"left\"\r\n      />\r\n      <BookFilters filters={filters} onChange={setFilters} />\r\n      <BookGrid\r\n        books={filteredBooks}\r\n        isLoading={booksStatus === 'loading'}\r\n        favorites={favorites}\r\n        onToggleFavorite={isAuthenticated ? toggleFavorite : undefined}\r\n        onRequestExchange={handleRequest}\r\n        onChat={handleChat}\r\n        isOwner={isOwner}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Browse;\r\n\r\n"],"mappings":";;AAAA,SAASA,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACzC,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAOC,WAAW,MAAM,iCAAiC;AACzD,OAAOC,QAAQ,MAAM,8BAA8B;AACnD,OAAOC,cAAc,MAAM,qCAAqC;AAChE,SAASC,UAAU,QAAQ,2BAA2B;AACtD,SAASC,OAAO,QAAQ,wBAAwB;AAChD,SAASC,YAAY,EAAEC,gBAAgB,QAAQ,iBAAiB;AAChE,SAASC,eAAe,QAAQ,gCAAgC;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEjE,MAAMC,MAAM,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnB,MAAM;IACJC,KAAK;IACLC,WAAW;IACXC,SAAS;IACTC,cAAc;IACdC,YAAY;IACZC,gBAAgB;IAChBC,OAAO;IACPC;EACF,CAAC,GAAGhB,UAAU,CAAC,CAAC;EAChB,MAAM;IAAEiB,eAAe;IAAEC,KAAK;IAAEC;EAAK,CAAC,GAAGlB,OAAO,CAAC,CAAC;EAClD,MAAM;IAAEmB;EAAO,CAAC,GAAGhB,eAAe,CAAC,CAAC;EACpC,MAAMiB,QAAQ,GAAGzB,WAAW,CAAC,CAAC;EAC9B,MAAM,CAAC0B,OAAO,EAAEC,UAAU,CAAC,GAAG5B,QAAQ,CAAC;IACrC6B,MAAM,EAAE,EAAE;IACVC,KAAK,EAAE,YAAY;IACnBC,MAAM,EAAE;EACV,CAAC,CAAC;EAEF,MAAMC,aAAa,GAAGjC,OAAO,CAAC,MAAM;IAClC,OAAOe,KAAK,CAACmB,MAAM,CAAEC,IAAI,IAAK;MAC5B,MAAMC,aAAa,GACjB,CAACR,OAAO,CAACE,MAAM,IACfK,IAAI,CAACE,KAAK,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACX,OAAO,CAACE,MAAM,CAACQ,WAAW,CAAC,CAAC,CAAC,IAC/DH,IAAI,CAACK,MAAM,CAACF,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACX,OAAO,CAACE,MAAM,CAACQ,WAAW,CAAC,CAAC,CAAC;MAClE,MAAMG,YAAY,GAAGb,OAAO,CAACG,KAAK,KAAK,YAAY,IAAII,IAAI,CAACJ,KAAK,KAAKH,OAAO,CAACG,KAAK;MACnF,MAAMW,aAAa,GAAGd,OAAO,CAACI,MAAM,KAAK,YAAY,IAAIG,IAAI,CAACH,MAAM,KAAKJ,OAAO,CAACI,MAAM;MACvF,OAAOI,aAAa,IAAIK,YAAY,IAAIC,aAAa;IACvD,CAAC,CAAC;EACJ,CAAC,EAAE,CAAC3B,KAAK,EAAEa,OAAO,CAAC,CAAC;EAEpB,MAAMe,WAAW,GAAGA,CAAA,KAAM;IACxB,IAAI,CAACpB,eAAe,EAAE;MACpBG,MAAM,CAAC,6BAA6B,EAAE,MAAM,CAAC;MAC7CC,QAAQ,CAAC,cAAc,EAAE;QAAEiB,OAAO,EAAE,IAAI;QAAEC,KAAK,EAAE;UAAEC,IAAI,EAAE;QAAU;MAAE,CAAC,CAAC;MACvE,OAAO,KAAK;IACd;IACA,OAAO,IAAI;EACb,CAAC;EAED,MAAMC,aAAa,GAAG,MAAOZ,IAAI,IAAK;IACpC,IAAI,CAACQ,WAAW,CAAC,CAAC,EAAE;IACpB,IAAI;MACF,MAAMnC,YAAY,CAACwC,MAAM,CACvB;QAAEC,MAAM,EAAEd,IAAI,CAACe,EAAE;QAAEC,OAAO,EAAE,4BAA4BhB,IAAI,CAACE,KAAK;MAAG,CAAC,EACtEb,KACF,CAAC;MACDE,MAAM,CAAC,wBAAwB,EAAE,SAAS,CAAC;MAC3CP,YAAY,CAAC,CAAC;MACdC,gBAAgB,CAAC,CAAC;IACpB,CAAC,CAAC,OAAOgC,GAAG,EAAE;MACZ1B,MAAM,CAAC0B,GAAG,CAACD,OAAO,IAAI,2BAA2B,EAAE,OAAO,CAAC;IAC7D;EACF,CAAC;EAED,MAAME,aAAa,GAAIlB,IAAI,IAAK;IAC9B,IAAI,CAACV,IAAI,EAAE,OAAO,KAAK;IACvB,OAAOH,SAAS,CAACgC,IAAI,CAClBC,QAAQ,IACPA,QAAQ,CAACN,MAAM,KAAKd,IAAI,CAACe,EAAE,IAC3B,CAACK,QAAQ,CAACC,OAAO,EAAED,QAAQ,CAACE,WAAW,CAAC,CAAClB,QAAQ,CAACd,IAAI,CAACyB,EAAE,CAAC,IAC1D,CAACK,QAAQ,CAACC,OAAO,EAAED,QAAQ,CAACE,WAAW,CAAC,CAAClB,QAAQ,CAACJ,IAAI,CAACqB,OAAO,CAClE,CAAC;EACH,CAAC;EAED,MAAME,UAAU,GAAG,MAAOvB,IAAI,IAAK;IACjC,IAAI,CAACQ,WAAW,CAAC,CAAC,EAAE;IACpB,IAAI,CAACU,aAAa,CAAClB,IAAI,CAAC,EAAE;MACxBT,MAAM,CAAC,kEAAkE,EAAE,MAAM,CAAC;MAClF;IACF;IACA,IAAI;MACF,MAAMiC,YAAY,GAAG,MAAMlD,gBAAgB,CAACuC,MAAM,CAChD;QAAEY,WAAW,EAAEzB,IAAI,CAACqB,OAAO;QAAEP,MAAM,EAAEd,IAAI,CAACe;MAAG,CAAC,EAC9C1B,KACF,CAAC;MACDG,QAAQ,CAAC,OAAO,EAAE;QAAEkB,KAAK,EAAE;UAAEgB,cAAc,EAAEF,YAAY,CAACT;QAAG;MAAE,CAAC,CAAC;IACnE,CAAC,CAAC,OAAOE,GAAG,EAAE;MACZ1B,MAAM,CAAC0B,GAAG,CAACD,OAAO,IAAI,sBAAsB,EAAE,OAAO,CAAC;IACxD;EACF,CAAC;EAED,oBACEvC,OAAA;IAAAkD,QAAA,gBACElD,OAAA,CAACP,cAAc;MACb0D,OAAO,EAAC,QAAQ;MAChB1B,KAAK,EAAC,sCAAsC;MAC5C2B,WAAW,EAAC,0FAA0F;MACtGC,KAAK,EAAC;IAAM;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACb,CAAC,eACFzD,OAAA,CAACT,WAAW;MAACyB,OAAO,EAAEA,OAAQ;MAAC0C,QAAQ,EAAEzC;IAAW;MAAAqC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACvDzD,OAAA,CAACR,QAAQ;MACPW,KAAK,EAAEkB,aAAc;MACrBsC,SAAS,EAAEvD,WAAW,KAAK,SAAU;MACrCC,SAAS,EAAEA,SAAU;MACrBuD,gBAAgB,EAAEjD,eAAe,GAAGL,cAAc,GAAGuD,SAAU;MAC/DC,iBAAiB,EAAE3B,aAAc;MACjC4B,MAAM,EAAEjB,UAAW;MACnBrC,OAAO,EAAEA;IAAQ;MAAA6C,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAClB,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACC,CAAC;AAEV,CAAC;AAACvD,EAAA,CAvGID,MAAM;EAAA,QAUNP,UAAU,EAC2BC,OAAO,EAC7BG,eAAe,EACjBR,WAAW;AAAA;AAAA0E,EAAA,GAbxB/D,MAAM;AAyGZ,eAAeA,MAAM;AAAC,IAAA+D,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}