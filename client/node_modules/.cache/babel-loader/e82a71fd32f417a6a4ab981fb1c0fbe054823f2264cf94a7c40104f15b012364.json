{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\dell\\\\Desktop\\\\pro\\\\book-exchange-app\\\\client\\\\src\\\\pages\\\\Browse.jsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport BookFilters from '../components/books/BookFilters';\nimport BookGrid from '../components/books/BookGrid';\nimport ShuffleSpotlight from '../components/books/ShuffleSpotlight';\nimport SectionHeading from '../components/common/SectionHeading';\nimport { useAppData } from '../context/AppDataContext';\nimport { useAuth } from '../context/AuthContext';\nimport { exchangesApi, conversationsApi } from '../services/api';\nimport { useNotification } from '../context/NotificationContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Browse = () => {\n  _s();\n  const {\n    books,\n    booksStatus,\n    favorites,\n    toggleFavorite,\n    refreshBooks,\n    refreshExchanges,\n    isOwner,\n    exchanges\n  } = useAppData();\n  const {\n    isAuthenticated,\n    token,\n    user\n  } = useAuth();\n  const {\n    notify\n  } = useNotification();\n  const navigate = useNavigate();\n  const [filters, setFilters] = useState({\n    search: '',\n    genre: 'All Genres',\n    status: 'Any Status'\n  });\n  const [spotlightBook, setSpotlightBook] = useState(null);\n  const filteredBooks = useMemo(() => {\n    return books.filter(book => {\n      const matchesSearch = !filters.search || book.title.toLowerCase().includes(filters.search.toLowerCase()) || book.author.toLowerCase().includes(filters.search.toLowerCase());\n      const matchesGenre = filters.genre === 'All Genres' || book.genre === filters.genre;\n      const matchesStatus = filters.status === 'Any Status' || book.status === filters.status;\n      return matchesSearch && matchesGenre && matchesStatus;\n    });\n  }, [books, filters]);\n  useEffect(() => {\n    if (filteredBooks.length) {\n      setSpotlightBook(filteredBooks[Math.floor(Math.random() * filteredBooks.length)]);\n    } else {\n      setSpotlightBook(null);\n    }\n  }, [filteredBooks]);\n  const shuffleSpotlight = () => {\n    if (!filteredBooks.length) return;\n    setSpotlightBook(filteredBooks[Math.floor(Math.random() * filteredBooks.length)]);\n  };\n  const requireAuth = () => {\n    if (!isAuthenticated) {\n      notify('Please sign in to continue.', 'info');\n      navigate('/auth/signin', {\n        replace: true,\n        state: {\n          from: '/browse'\n        }\n      });\n      return false;\n    }\n    return true;\n  };\n  const handleRequest = async book => {\n    if (!requireAuth()) return;\n    try {\n      await exchangesApi.create({\n        bookId: book.id,\n        message: `I'd love to exchange for ${book.title}`\n      }, token);\n      notify('Exchange request sent.', 'success');\n      refreshBooks();\n      refreshExchanges();\n    } catch (err) {\n      notify(err.message || 'Unable to create request.', 'error');\n    }\n  };\n  const canChatOnBook = book => {\n    if (!user) return false;\n    return exchanges.some(exchange => exchange.bookId === book.id && [exchange.ownerId, exchange.requesterId].includes(user.id) && [exchange.ownerId, exchange.requesterId].includes(book.ownerId));\n  };\n  const handleChat = async book => {\n    if (!requireAuth()) return;\n    if (!canChatOnBook(book)) {\n      notify('Send or accept an exchange request to unlock chat for this book.', 'info');\n      return;\n    }\n    try {\n      const conversation = await conversationsApi.create({\n        otherUserId: book.ownerId,\n        bookId: book.id\n      }, token);\n      navigate('/chat', {\n        state: {\n          conversationId: conversation.id\n        }\n      });\n    } catch (err) {\n      notify(err.message || 'Unable to open chat.', 'error');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(SectionHeading, {\n      eyebrow: \"Browse\",\n      title: \"Seamless marketplace for every genre\",\n      description: \"Use filters, favorites, and quick actions to find the exact story you want to read next.\",\n      align: \"left\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(BookFilters, {\n      filters: filters,\n      onChange: setFilters\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this), spotlightBook && /*#__PURE__*/_jsxDEV(ShuffleSpotlight, {\n      book: spotlightBook,\n      onShuffle: shuffleSpotlight\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(BookGrid, {\n      books: filteredBooks,\n      isLoading: booksStatus === 'loading',\n      favorites: favorites,\n      onToggleFavorite: isAuthenticated ? toggleFavorite : undefined,\n      onRequestExchange: handleRequest,\n      onChat: handleChat,\n      isOwner: isOwner\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n};\n_s(Browse, \"UWpTdQS4u4ahMaj3b28rpzhdayE=\", false, function () {\n  return [useAppData, useAuth, useNotification, useNavigate];\n});\n_c = Browse;\nexport default Browse;\nvar _c;\n$RefreshReg$(_c, \"Browse\");","map":{"version":3,"names":["useEffect","useMemo","useState","useNavigate","BookFilters","BookGrid","ShuffleSpotlight","SectionHeading","useAppData","useAuth","exchangesApi","conversationsApi","useNotification","jsxDEV","_jsxDEV","Browse","_s","books","booksStatus","favorites","toggleFavorite","refreshBooks","refreshExchanges","isOwner","exchanges","isAuthenticated","token","user","notify","navigate","filters","setFilters","search","genre","status","spotlightBook","setSpotlightBook","filteredBooks","filter","book","matchesSearch","title","toLowerCase","includes","author","matchesGenre","matchesStatus","length","Math","floor","random","shuffleSpotlight","requireAuth","replace","state","from","handleRequest","create","bookId","id","message","err","canChatOnBook","some","exchange","ownerId","requesterId","handleChat","conversation","otherUserId","conversationId","children","eyebrow","description","align","fileName","_jsxFileName","lineNumber","columnNumber","onChange","onShuffle","isLoading","onToggleFavorite","undefined","onRequestExchange","onChat","_c","$RefreshReg$"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/pages/Browse.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport BookFilters from '../components/books/BookFilters';\r\nimport BookGrid from '../components/books/BookGrid';\r\nimport ShuffleSpotlight from '../components/books/ShuffleSpotlight';\r\nimport SectionHeading from '../components/common/SectionHeading';\r\nimport { useAppData } from '../context/AppDataContext';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { exchangesApi, conversationsApi } from '../services/api';\r\nimport { useNotification } from '../context/NotificationContext';\r\n\r\nconst Browse = () => {\r\n  const {\r\n    books,\r\n    booksStatus,\r\n    favorites,\r\n    toggleFavorite,\r\n    refreshBooks,\r\n    refreshExchanges,\r\n    isOwner,\r\n    exchanges,\r\n  } = useAppData();\r\n  const { isAuthenticated, token, user } = useAuth();\r\n  const { notify } = useNotification();\r\n  const navigate = useNavigate();\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    genre: 'All Genres',\r\n    status: 'Any Status',\r\n  });\r\n  const [spotlightBook, setSpotlightBook] = useState(null);\r\n\r\n  const filteredBooks = useMemo(() => {\r\n    return books.filter((book) => {\r\n      const matchesSearch =\r\n        !filters.search ||\r\n        book.title.toLowerCase().includes(filters.search.toLowerCase()) ||\r\n        book.author.toLowerCase().includes(filters.search.toLowerCase());\r\n      const matchesGenre = filters.genre === 'All Genres' || book.genre === filters.genre;\r\n      const matchesStatus = filters.status === 'Any Status' || book.status === filters.status;\r\n      return matchesSearch && matchesGenre && matchesStatus;\r\n    });\r\n  }, [books, filters]);\r\n\r\n  useEffect(() => {\r\n    if (filteredBooks.length) {\r\n      setSpotlightBook(filteredBooks[Math.floor(Math.random() * filteredBooks.length)]);\r\n    } else {\r\n      setSpotlightBook(null);\r\n    }\r\n  }, [filteredBooks]);\r\n\r\n  const shuffleSpotlight = () => {\r\n    if (!filteredBooks.length) return;\r\n    setSpotlightBook(filteredBooks[Math.floor(Math.random() * filteredBooks.length)]);\r\n  };\r\n\r\n  const requireAuth = () => {\r\n    if (!isAuthenticated) {\r\n      notify('Please sign in to continue.', 'info');\r\n      navigate('/auth/signin', { replace: true, state: { from: '/browse' } });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleRequest = async (book) => {\r\n    if (!requireAuth()) return;\r\n    try {\r\n      await exchangesApi.create(\r\n        { bookId: book.id, message: `I'd love to exchange for ${book.title}` },\r\n        token\r\n      );\r\n      notify('Exchange request sent.', 'success');\r\n      refreshBooks();\r\n      refreshExchanges();\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to create request.', 'error');\r\n    }\r\n  };\r\n\r\n  const canChatOnBook = (book) => {\r\n    if (!user) return false;\r\n    return exchanges.some(\r\n      (exchange) =>\r\n        exchange.bookId === book.id &&\r\n        [exchange.ownerId, exchange.requesterId].includes(user.id) &&\r\n        [exchange.ownerId, exchange.requesterId].includes(book.ownerId)\r\n    );\r\n  };\r\n\r\n  const handleChat = async (book) => {\r\n    if (!requireAuth()) return;\r\n    if (!canChatOnBook(book)) {\r\n      notify('Send or accept an exchange request to unlock chat for this book.', 'info');\r\n      return;\r\n    }\r\n    try {\r\n      const conversation = await conversationsApi.create(\r\n        { otherUserId: book.ownerId, bookId: book.id },\r\n        token\r\n      );\r\n      navigate('/chat', { state: { conversationId: conversation.id } });\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to open chat.', 'error');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <SectionHeading\r\n        eyebrow=\"Browse\"\r\n        title=\"Seamless marketplace for every genre\"\r\n        description=\"Use filters, favorites, and quick actions to find the exact story you want to read next.\"\r\n        align=\"left\"\r\n      />\r\n      <BookFilters filters={filters} onChange={setFilters} />\r\n      {spotlightBook && (\r\n        <ShuffleSpotlight book={spotlightBook} onShuffle={shuffleSpotlight} />\r\n      )}\r\n      <BookGrid\r\n        books={filteredBooks}\r\n        isLoading={booksStatus === 'loading'}\r\n        favorites={favorites}\r\n        onToggleFavorite={isAuthenticated ? toggleFavorite : undefined}\r\n        onRequestExchange={handleRequest}\r\n        onChat={handleChat}\r\n        isOwner={isOwner}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Browse;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}