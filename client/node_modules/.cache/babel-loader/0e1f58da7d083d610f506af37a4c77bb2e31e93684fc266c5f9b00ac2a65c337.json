{"ast":null,"code":"import _objectSpread from\"C:/Users/dell/Desktop/pro/book-exchange-app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Book,Search,PlusCircle,Library,User,LogOut,RefreshCw,MapPin,Heart,MessageSquare,ArrowRight}from'lucide-react';// Use the server API (file-based) instead of Firebase.\nconst API_BASE='';const BOOKS_API=\"\".concat(API_BASE,\"/api/books\");// --- Components ---\nconst Navbar=_ref=>{let{user,setView,currentView,handleLogin,handleLogout}=_ref;return/*#__PURE__*/_jsx(\"nav\",{className:\"site-header sticky top-0 z-50 px-4 py-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 cursor-pointer site-logo\",onClick:()=>setView('home'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo-badge\",children:/*#__PURE__*/_jsx(Book,{className:\"w-6 h-6 text-white\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"logo-text\",children:\"BookLoop\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('browse'),className:\"text-sm font-medium transition \".concat(currentView==='browse'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:\"Browse Books\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('chat'),className:\"text-sm font-medium transition \".concat(currentView==='chat'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:\"Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('exchanges'),className:\"text-sm font-medium transition \".concat(currentView==='exchanges'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:\"Requests\"}),user?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setView('favorites'),className:\"text-sm font-medium transition flex items-center gap-1 \".concat(currentView==='favorites'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:[/*#__PURE__*/_jsx(Heart,{className:\"w-4 h-4\"}),\"Favorites\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setView('add'),className:\"text-sm font-medium transition flex items-center gap-1 \".concat(currentView==='add'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:[/*#__PURE__*/_jsx(PlusCircle,{className:\"w-4 h-4\"}),\"Add Book\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 pl-4 border-l\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('profile'),className:\"text-sm font-medium transition flex items-center justify-center \".concat(currentView==='profile'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),title:\"Profile\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-bold text-xs\",children:((user===null||user===void 0?void 0:user.id)||'').slice(0,2).toUpperCase()})}),/*#__PURE__*/_jsx(\"div\",{id:\"nav-unread-badge\",className:\"absolute -top-2 -right-2 bg-rose-500 text-white text-[10px] px-1 rounded-full hidden\",children:\"0\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"text-gray-400 hover:text-red-500 transition\",title:\"Logout\",children:/*#__PURE__*/_jsx(LogOut,{className:\"w-5 h-5\"})})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('signin'),className:\"text-sm text-gray-700 hover:text-gray-900\",children:\"Sign In\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('signup'),className:\"bg-emerald-600 text-white px-3 py-1 rounded-md text-sm\",children:\"Sign Up\"})]})]})]})});};const Hero=_ref2=>{let{setView,handleLogin,user}=_ref2;return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-b from-emerald-50 to-white pt-20 pb-24 px-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center gap-2 bg-white/6 text-emerald-300 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-6 backdrop-blur\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3\"}),\"The #1 Book Exchange Platform\"]}),/*#__PURE__*/_jsxs(\"h1\",{className:\"text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 leading-tight\",children:[\"Give a Book. \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500\",children:\"Get a Book.\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-gray-600 mb-10 max-w-2xl mx-auto leading-relaxed\",children:\"Join a community of readers. Upload the books gathering dust on your shelf and swap them for your next great adventure.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row items-center justify-center gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('browse'),className:\"neon-btn w-full sm:w-auto\",children:\"Start Browsing\"}),!user&&/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,className:\"outline-btn w-full sm:w-auto px-8 py-4 font-bold text-lg transition\",children:\"Join Now\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-16 grid grid-cols-3 gap-8 max-w-2xl mx-auto border-t pt-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-gray-900\",children:\"2k+\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:\"Active Readers\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-gray-900\",children:\"5k+\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:\"Books Swapped\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-gray-900\",children:\"100%\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:\"Free to Join\"})]})]})]})});};const BookCard=_ref3=>{let{book,user,handleExchange,handleChat,isFavorited,onToggleFavorite}=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"group fancy-card animate-tilt flex flex-col overflow-hidden h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"h-48 overflow-hidden relative bg-gray-100\",children:[book.imageUrl?/*#__PURE__*/_jsx(\"img\",{src:book.imageUrl,alt:book.title,className:\"w-full h-full object-cover transition duration-500 group-hover:scale-105\",onError:e=>{e.target.src='https://images.unsplash.com/photo-1543002588-bfa74002ed7e?auto=format&fit=crop&q=80&w=2730';}}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-full flex items-center justify-center text-gray-300 bg-slate-50\",children:/*#__PURE__*/_jsx(Book,{className:\"w-16 h-16\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-bold text-gray-700 shadow-sm\",children:book.condition}),user&&onToggleFavorite&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>onToggleFavorite(book.id),className:\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm p-2 rounded-md hover:bg-white transition shadow-sm\",title:isFavorited?'Remove from favorites':'Add to favorites',children:/*#__PURE__*/_jsx(Heart,{className:\"w-5 h-5 \".concat(isFavorited?'fill-red-500 text-red-500':'text-gray-400')})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-5 flex flex-col flex-grow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-semibold text-emerald-600 mb-2 uppercase tracking-wider\",children:book.genre||'General'}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold text-gray-900 mb-1 leading-tight\",children:book.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mb-4\",children:[\"by \",book.author]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs text-gray-400 mb-6 mt-auto\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-3 h-3\"}),/*#__PURE__*/_jsx(\"span\",{children:book.location||'Remote'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between pt-4 border-t border-gray-50 mt-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 rounded-full bg-gradient-to-br from-purple-400 to-indigo-500 text-[10px] text-white flex items-center justify-center\",children:book.ownerId?book.ownerId.slice(0,2).toUpperCase():'??'}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500\",children:\"Owner\"})]}),user&&user.id===book.ownerId?/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-medium text-gray-400 bg-gray-100 px-3 py-1 rounded-full\",children:\"Your Book\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"card-actions\",children:[book.status&&book.status!=='available'?/*#__PURE__*/_jsx(\"span\",{className:\"glow-badge\",children:book.status}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleExchange(book),disabled:book.status==='exchanged',className:\"neon-btn \".concat(book.status==='exchanged'?'opacity-60 cursor-not-allowed':''),children:book.status==='exchanged'?'Taken':'Request'}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleChat&&handleChat(book),className:\"text-sm px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Message\"})]})]})]})]})]});};const Browse=_ref4=>{let{books,loading,user,handleExchange,handleChat,favorites,onToggleFavorite}=_ref4;const[searchTerm,setSearchTerm]=useState('');const filteredBooks=books.filter(book=>book.title.toLowerCase().includes(searchTerm.toLowerCase())||book.author.toLowerCase().includes(searchTerm.toLowerCase()));return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Explore Collection\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Find your next favorite read.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative w-full md:w-96\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by title or author...\",className:\"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]})]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600\"})}):filteredBooks.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200\",children:[/*#__PURE__*/_jsx(Book,{className:\"w-12 h-12 text-gray-300 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"No books found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Try adjusting your search terms.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:filteredBooks.map(book=>/*#__PURE__*/_jsx(BookCard,{book:book,user:user,handleExchange:handleExchange,handleChat:handleChat,isFavorited:favorites.includes(book.id),onToggleFavorite:onToggleFavorite},book.id))})]});};const Favorites=_ref5=>{let{books,loading,user,handleExchange,handleChat,favorites,onToggleFavorite}=_ref5;const favoriteBooks=books.filter(b=>favorites.includes(b.id));return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-8\",children:[/*#__PURE__*/_jsx(Heart,{className:\"w-8 h-8 text-red-500 fill-red-500\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"My Favorites\"})]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600\"})}):favoriteBooks.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200\",children:[/*#__PURE__*/_jsx(Heart,{className:\"w-12 h-12 text-gray-300 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"No favorites yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Click the heart icon on books you love.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:favoriteBooks.map(book=>/*#__PURE__*/_jsx(BookCard,{book:book,user:user,handleExchange:handleExchange,handleChat:handleChat,isFavorited:true,onToggleFavorite:onToggleFavorite},book.id))})]});};const AddBook=_ref6=>{let{setView,user,token,onNotify}=_ref6;const[loading,setLoading]=useState(false);const[formData,setFormData]=useState({title:'',author:'',genre:'Fiction',condition:'Good',location:'',imageUrl:''});const handleSubmit=async e=>{e.preventDefault();if(!user)return;setLoading(true);try{// Post to server\nawait fetch(BOOKS_API,{method:'POST',headers:{'Content-Type':'application/json',Authorization:token?\"Bearer \".concat(token):''},body:JSON.stringify(_objectSpread(_objectSpread({},formData),{},{ownerId:user.id}))});setView('browse');if(onNotify)onNotify('Book added successfully!','success');}catch(error){console.error(\"Error adding book:\",error);if(onNotify)onNotify(\"Failed to add book. Try again.\",'error');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded-2xl shadow-lg border border-gray-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-emerald-100 p-3 rounded-full\",children:/*#__PURE__*/_jsx(PlusCircle,{className:\"w-6 h-6 text-emerald-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"List a Book\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm\",children:\"Share a book with the community\"})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Book Title\"}),/*#__PURE__*/_jsx(\"input\",{required:true,className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"e.g. The Great Gatsby\",value:formData.title,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Author\"}),/*#__PURE__*/_jsx(\"input\",{required:true,className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"e.g. F. Scott Fitzgerald\",value:formData.author,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{author:e.target.value}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Genre\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\",value:formData.genre,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{genre:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{children:\"Fiction\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Non-Fiction\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Sci-Fi\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Mystery\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Biography\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Textbook\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Condition\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\",value:formData.condition,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{condition:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{children:\"New\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Like New\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Good\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Fair\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Poor\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Cover Image URL\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"https://example.com/image.jpg\",value:formData.imageUrl,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{imageUrl:e.target.value}))}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Tip: Search Google Images, right click image, \\\"Copy Image Address\\\"\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"City/Location\"}),/*#__PURE__*/_jsx(\"input\",{required:true,className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"e.g. New York, NY\",value:formData.location,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{location:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-4 flex gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setView('browse'),className:\"flex-1 px-6 py-3 border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"flex-1 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl shadow-lg shadow-emerald-200 transition flex justify-center items-center\",children:loading?/*#__PURE__*/_jsx(\"span\",{className:\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"}):'List Book'})]})]})]})});};// --- Main App Component ---\nexport default function App(){const[user,setUser]=useState(null);const[books,setBooks]=useState([]);const[loading,setLoading]=useState(true);const[currentView,setCurrentView]=useState('home');// home, browse, add, favorites, chat, exchanges, profile\nconst[notification,setNotification]=useState(null);const[token,setToken]=useState(null);const[conversationId,setConversationId]=useState(null);const[exchanges,setExchanges]=useState([]);const[unreadTotal,setUnreadTotal]=useState(0);const[favorites,setFavorites]=useState([]);const apiFetch=function(url){let opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const headers=opts.headers||{};if(token)headers['Authorization']=\"Bearer \".concat(token);return fetch(url,_objectSpread(_objectSpread({},opts),{},{headers}));};// 1. Auth Handling (JWT stored in localStorage)\nuseEffect(()=>{const t=localStorage.getItem('be_token');const u=localStorage.getItem('be_user');if(t)setToken(t);if(u)setUser(JSON.parse(u));// verify token and refresh user\nif(t){fetch('/api/me',{headers:{Authorization:\"Bearer \".concat(t)}}).then(r=>r.json()).then(data=>{if(!data.error){setUser(data);localStorage.setItem('be_user',JSON.stringify(data));}else{localStorage.removeItem('be_token');localStorage.removeItem('be_user');setToken(null);setUser(null);}}).catch(()=>{});}},[]);// 2. Data Fetching\nconst fetchBooks=async()=>{setLoading(true);try{const res=await fetch(BOOKS_API);const data=await res.json();setBooks(data||[]);}catch(err){console.error('Fetch books error',err);}finally{setLoading(false);}};const fetchExchanges=async()=>{if(!token)return setExchanges([]);try{const res=await apiFetch('/api/exchanges');const data=await res.json();setExchanges(data||[]);}catch(e){console.error(e);}};const fetchFavorites=async()=>{if(!token)return setFavorites([]);try{const res=await apiFetch('/api/users/favorites');const data=await res.json();if(data&&!data.error){setFavorites(data.map(b=>b.id)||[]);}}catch(e){console.error(e);}};const handleToggleFavorite=async bookId=>{if(!token)return;try{const res=await apiFetch('/api/users/favorite',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({bookId})});const data=await res.json();if(data.favorites){setFavorites(data.favorites);const isFav=data.favorites.includes(bookId);showNotification(isFav?'Added to favorites':'Removed from favorites','success');}}catch(e){console.error(e);showNotification('Failed to update favorite','error');}};useEffect(()=>{fetchBooks();},[]);useEffect(()=>{fetchExchanges();},[token]);useEffect(()=>{fetchFavorites();},[token]);useEffect(()=>{// compute unread total from conversations\nasync function compute(){if(!token)return setUnreadTotal(0);try{const r=await fetch('/api/conversations',{headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();const total=(d||[]).reduce((s,c)=>s+(c.unreadCount||0),0);setUnreadTotal(total);// update navbar badge\nconst badge=document.getElementById('nav-unread-badge');if(badge){if(total>0){badge.textContent=total;badge.classList.remove('hidden');}else{badge.classList.add('hidden');}}}catch(e){console.error(e);}}compute();},[token,conversationId]);// Actions\nconst handleLogin=()=>setCurrentView('signin');const doSignup=async(name,email,password)=>{try{const res=await fetch('/api/signup',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,password})});const data=await res.json();if(data.token){localStorage.setItem('be_token',data.token);localStorage.setItem('be_user',JSON.stringify(data.user));setToken(data.token);setUser(data.user);setCurrentView('browse');showNotification('Account created','success');}else{showNotification(data.error||'Signup failed','error');}}catch(err){showNotification('Signup failed','error');}};const doLogin=async(email,password)=>{try{const res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await res.json();if(data.token){localStorage.setItem('be_token',data.token);localStorage.setItem('be_user',JSON.stringify(data.user));setToken(data.token);setUser(data.user);setCurrentView('browse');showNotification('Signed in','success');}else{showNotification(data.error||'Login failed','error');}}catch(err){showNotification('Login failed','error');}};const handleLogout=()=>{localStorage.removeItem('be_user');localStorage.removeItem('be_token');setUser(null);setToken(null);setCurrentView('home');showNotification('Logged out','default');};const handleExchange=async book=>{if(!user){showNotification('Please sign in to request books.','error');return;}if(!confirm(\"Request to exchange \\\"\".concat(book.title,\"\\\"?\")))return;try{var _data$conversation;// create an exchange request (server will create/get conversation)\nconst res=await apiFetch('/api/exchanges',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({bookId:book.id,message:\"I'd like to request \".concat(book.title)})});const data=await res.json();if(!res.ok)throw new Error(data.error||'Failed to create exchange');const conv=data.conversation||data.conversationId||((_data$conversation=data.conversation)===null||_data$conversation===void 0?void 0:_data$conversation.id)||(data.conversation&&data.conversation.id?data.conversation:null);if(conv&&conv.id){setConversationId(conv.id);setCurrentView('chat');}else if(data.conversation&&data.conversation.id){setConversationId(data.conversation.id);setCurrentView('chat');}showNotification('Request sent and private chat opened.','success');fetchBooks();fetchExchanges();}catch(err){console.error(err);showNotification('Failed to process exchange.','error');}};const handleChat=async book=>{if(!user){showNotification('Please sign in to chat with owners.','error');setCurrentView('signin');return;}try{const res=await apiFetch('/api/conversations',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({otherUserId:book.ownerId,bookId:book.id})});const data=await res.json();if(!res.ok)throw new Error(data.error||'Failed to create conversation');const conv=data||null;if(conv&&conv.id){setConversationId(conv.id);setCurrentView('chat');}showNotification('Private chat opened with owner.','success');}catch(err){console.error(err);showNotification('Failed to open chat.','error');}};const showNotification=function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'default';setNotification({message,type});setTimeout(()=>setNotification(null),3000);};// Helper for View Rendering\nconst renderView=()=>{switch(currentView){case'home':return/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});case'browse':return/*#__PURE__*/_jsx(Browse,{books:books,loading:loading,user:user,handleExchange:handleExchange,handleChat:handleChat,favorites:favorites,onToggleFavorite:handleToggleFavorite});case'favorites':return user?/*#__PURE__*/_jsx(Favorites,{books:books,loading:loading,user:user,handleExchange:handleExchange,handleChat:handleChat,favorites:favorites,onToggleFavorite:handleToggleFavorite}):/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});case'add':return user?/*#__PURE__*/_jsx(AddBook,{setView:setCurrentView,user:user,token:token,onNotify:showNotification}):/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});case'signin':return/*#__PURE__*/_jsx(SignIn,{onLogin:doLogin,onSwitch:()=>setCurrentView('signup')});case'signup':return/*#__PURE__*/_jsx(SignUp,{onSignup:doSignup,onSwitch:()=>setCurrentView('signin')});case'chat':return/*#__PURE__*/_jsx(Chat,{user:user,token:token,conversationId:conversationId,onSelectConversation:id=>{setConversationId(id);setCurrentView('chat');},onLeave:()=>{setConversationId(null);setCurrentView('chat');}});case'exchanges':return/*#__PURE__*/_jsx(Exchanges,{user:user,token:token,exchanges:exchanges,refresh:fetchExchanges,onOpenConversation:id=>{setConversationId(id);setCurrentView('chat');},onNotify:showNotification});case'profile':return/*#__PURE__*/_jsx(Profile,{user:user,onUpdate:u=>{setUser(u);localStorage.setItem('be_user',JSON.stringify(u));},token:token});default:return/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen pb-10 fancy-app\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-blob\"}),/*#__PURE__*/_jsx(Navbar,{user:user,setView:setCurrentView,currentView:currentView,handleLogin:handleLogin,handleLogout:handleLogout}),notification&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed top-20 right-4 z-50 px-6 py-3 rounded-lg shadow-xl border animate-fade-in-down \".concat(notification.type==='success'?'bg-emerald-100 border-emerald-200 text-emerald-800':notification.type==='error'?'bg-red-100 border-red-200 text-red-800':'bg-gray-800 text-white'),children:notification.message}),/*#__PURE__*/_jsx(\"main\",{children:renderView()})]});}// --- Auth / Chat / Profile UI Components ---\nfunction SignIn(_ref7){let{onLogin,onSwitch}=_ref7;const[email,setEmail]=useState('');const[password,setPassword]=useState('');return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Sign In\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",placeholder:\"Email\",value:email,onChange:e=>setEmail(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"w-full mb-4 p-2 border rounded\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onLogin(email,password),className:\"bg-emerald-600 text-white px-4 py-2 rounded\",children:\"Sign In\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onSwitch,className:\"px-4 py-2 border rounded\",children:\"Create Account\"})]})]})});}function SignUp(_ref8){let{onSignup,onSwitch}=_ref8;const[name,setName]=useState('');const[email,setEmail]=useState('');const[password,setPassword]=useState('');return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Create Account\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",placeholder:\"Name\",value:name,onChange:e=>setName(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",placeholder:\"Email\",value:email,onChange:e=>setEmail(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"w-full mb-4 p-2 border rounded\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onSignup(name,email,password),className:\"bg-emerald-600 text-white px-4 py-2 rounded\",children:\"Sign Up\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onSwitch,className:\"px-4 py-2 border rounded\",children:\"Sign In\"})]})]})});}import{io as ioClient}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Chat(_ref9){let{user,token,conversationId,onSelectConversation,onLeave}=_ref9;const[messages,setMessages]=useState([]);const[text,setText]=useState('');const[conversations,setConversations]=useState([]);const socketRef=React.useRef(null);useEffect(()=>{let mounted=true;async function load(){// Only load messages if a conversation is open\nif(conversationId){const res=await fetch(\"/api/conversations/\".concat(conversationId,\"/messages\"),{headers:{Authorization:token?\"Bearer \".concat(token):''}});const data=await res.json();if(mounted)setMessages(data||[]);}}async function loadConvs(){if(!token)return;const r=await fetch('/api/conversations',{headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();setConversations(d||[]);}load();loadConvs();// connect socket\nsocketRef.current=ioClient(window.location.origin.replace(/:\\d+$/,'')+':5000');// identify the socket with token so server can join user-specific room\nif(token){socketRef.current.emit('identify',token);}socketRef.current.on('conversationMessage',msg=>{// only append if it belongs to our open conversation\nif(conversationId&&msg.conversationId===conversationId)setMessages(prev=>[...prev,msg]);// if not open, update conversation list (unread handled server-side)\nif(!conversationId)loadConvs();});// exchange notifications\nsocketRef.current.on('exchangeRequest',ex=>{showNotification('New exchange request','default');fetchExchanges();loadConvs();});socketRef.current.on('exchangeAccepted',ex=>{showNotification('An exchange was accepted','success');fetchExchanges();fetchBooks();});socketRef.current.on('exchangeDeclined',ex=>{showNotification('An exchange was declined','error');fetchExchanges();});return()=>{mounted=false;if(socketRef.current)socketRef.current.disconnect();};},[conversationId,token]);useEffect(()=>{// when conversationId changes, join/leave socket room\nif(!socketRef.current)return;if(conversationId){socketRef.current.emit('joinConversation',conversationId);// mark read on server\nif(token)fetch(\"/api/conversations/\".concat(conversationId,\"/read\"),{method:'PUT',headers:{Authorization:\"Bearer \".concat(token)}}).catch(()=>{});}return()=>{if(conversationId)socketRef.current.emit('leaveConversation',conversationId);};},[conversationId]);const send=async()=>{if(!text.trim())return;try{if(conversationId){// send via socket to conversation room\nif(socketRef.current&&socketRef.current.connected){socketRef.current.emit('sendConversationMessage',{token,text,conversationId});}else{await fetch(\"/api/conversations/\".concat(conversationId,\"/messages\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:token?\"Bearer \".concat(token):''},body:JSON.stringify({text})});}}setText('');}catch(e){console.error(e);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold\",children:\"Chat\"}),conversationId?/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(onLeave)onLeave();},className:\"text-sm text-gray-600\",children:\"Leave\"}):null]}),!conversationId&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2\",children:\"Your Conversations\"}),conversations.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"No conversations yet. Request a book to start a private chat.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:conversations.map(c=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onSelectConversation&&onSelectConversation(c.id),className:\"w-full text-left p-3 border rounded hover:bg-gray-50 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium\",children:[\"Conversation about \",c.bookId?\"book:\".concat(c.bookId):'general']}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"With: \",(c.participantsInfo||c.participants).map(p=>p.name||p).filter(Boolean).join(', ')]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[c.unreadCount?/*#__PURE__*/_jsx(\"div\",{className:\"bg-emerald-600 text-white text-xs px-2 py-1 rounded-full\",children:c.unreadCount}):null,/*#__PURE__*/_jsx(ArrowRight,{className:\"w-4 h-4 text-gray-400\"})]})]},c.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-glass p-4 rounded shadow h-[55vh] flex flex-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-auto mb-4\",children:messages.map(m=>/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[m.fromName||m.from,\" \\u2022 \",new Date(m.createdAt).toLocaleTimeString()]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-100 inline-block p-2 rounded mt-1\",children:m.text})]},m.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{value:text,onChange:e=>setText(e.target.value),className:\"flex-1 p-2 border rounded\",placeholder:user&&conversationId?'Message the other participant...':'Select a conversation to start messaging',disabled:!user||!conversationId}),/*#__PURE__*/_jsx(\"button\",{onClick:send,className:\"bg-emerald-600 text-white px-4 py-2 rounded\",disabled:!user||!conversationId,children:\"Send\"})]})]})]});}function Profile(_ref0){let{user,onUpdate,token}=_ref0;const[name,setName]=useState((user===null||user===void 0?void 0:user.name)||'');const[bio,setBio]=useState((user===null||user===void 0?void 0:user.bio)||'');const save=async()=>{try{if(!token)return;const res=await fetch(\"/api/users/\".concat(user.id),{method:'PUT',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)},body:JSON.stringify({name,bio})});const data=await res.json();if(res.ok){onUpdate(data);showNotification('Profile updated','success');}else{showNotification(data.error||'Failed to update profile','error');}}catch(e){console.error(e);showNotification('Failed to update profile','error');}};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Profile\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",value:name,onChange:e=>setName(e.target.value)}),/*#__PURE__*/_jsx(\"textarea\",{className:\"w-full mb-2 p-2 border rounded\",value:bio,onChange:e=>setBio(e.target.value)}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:/*#__PURE__*/_jsx(\"button\",{onClick:save,className:\"bg-emerald-600 text-white px-4 py-2 rounded\",children:\"Save\"})})]})});}function Exchanges(_ref1){let{user,token,exchanges,refresh,onOpenConversation,onNotify}=_ref1;const accept=async id=>{if(!token)return;try{const r=await fetch(\"/api/exchanges/\".concat(id,\"/accept\"),{method:'PUT',headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();if(r.ok){refresh();if(onNotify)onNotify('Exchange accepted!','success');}else if(onNotify)onNotify(d.error||'Failed to accept','error');}catch(e){console.error(e);if(onNotify)onNotify('Failed to accept','error');}};const decline=async id=>{if(!token)return;try{const r=await fetch(\"/api/exchanges/\".concat(id,\"/decline\"),{method:'PUT',headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();if(r.ok){refresh();if(onNotify)onNotify('Exchange declined','success');}else if(onNotify)onNotify(d.error||'Failed to decline','error');}catch(e){console.error(e);if(onNotify)onNotify('Failed to decline','error');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Exchange Requests\"}),exchanges.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"No exchange activity.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:exchanges.map(e=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border p-4 rounded flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"Book: \",e.bookId]}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[\"From: \",e.requesterId,\" \\u2014 Status: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:e.status})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 mt-2\",children:e.message}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400 mt-2\",children:[\"Requested at: \",new Date(e.createdAt).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-2\",children:[e.ownerId===(user===null||user===void 0?void 0:user.id)&&e.status==='requested'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>accept(e.id),className:\"px-3 py-2 bg-emerald-600 text-white rounded\",children:\"Accept\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>decline(e.id),className:\"px-3 py-2 border rounded\",children:\"Decline\"})]}):null,/*#__PURE__*/_jsx(\"button\",{onClick:()=>{var _e$conversation;return onOpenConversation&&onOpenConversation(e.conversationId||((_e$conversation=e.conversation)===null||_e$conversation===void 0?void 0:_e$conversation.id));},className:\"px-3 py-2 bg-gray-100 rounded\",children:\"Open Chat\"})]})]},e.id))})]});}","map":{"version":3,"names":["React","useState","useEffect","Book","Search","PlusCircle","Library","User","LogOut","RefreshCw","MapPin","Heart","MessageSquare","ArrowRight","API_BASE","BOOKS_API","concat","Navbar","_ref","user","setView","currentView","handleLogin","handleLogout","_jsx","className","children","_jsxs","onClick","_Fragment","title","id","slice","toUpperCase","Hero","_ref2","BookCard","_ref3","book","handleExchange","handleChat","isFavorited","onToggleFavorite","imageUrl","src","alt","onError","e","target","condition","genre","author","location","ownerId","status","disabled","Browse","_ref4","books","loading","favorites","searchTerm","setSearchTerm","filteredBooks","filter","toLowerCase","includes","type","placeholder","value","onChange","length","map","Favorites","_ref5","favoriteBooks","b","AddBook","_ref6","token","onNotify","setLoading","formData","setFormData","handleSubmit","preventDefault","fetch","method","headers","Authorization","body","JSON","stringify","_objectSpread","error","console","onSubmit","required","App","setUser","setBooks","setCurrentView","notification","setNotification","setToken","conversationId","setConversationId","exchanges","setExchanges","unreadTotal","setUnreadTotal","setFavorites","apiFetch","url","opts","arguments","undefined","t","localStorage","getItem","u","parse","then","r","json","data","setItem","removeItem","catch","fetchBooks","res","err","fetchExchanges","fetchFavorites","handleToggleFavorite","bookId","isFav","showNotification","compute","d","total","reduce","s","c","unreadCount","badge","document","getElementById","textContent","classList","remove","add","doSignup","name","email","password","doLogin","confirm","_data$conversation","message","ok","Error","conv","conversation","otherUserId","setTimeout","renderView","SignIn","onLogin","onSwitch","SignUp","onSignup","Chat","onSelectConversation","onLeave","Exchanges","refresh","onOpenConversation","Profile","onUpdate","_ref7","setEmail","setPassword","_ref8","setName","io","ioClient","jsx","jsxs","Fragment","_ref9","messages","setMessages","text","setText","conversations","setConversations","socketRef","useRef","mounted","load","loadConvs","current","window","origin","replace","emit","on","msg","prev","ex","disconnect","send","trim","connected","participantsInfo","participants","p","Boolean","join","m","fromName","from","Date","createdAt","toLocaleTimeString","_ref0","bio","setBio","save","_ref1","accept","decline","requesterId","toLocaleString","_e$conversation"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Book, \r\n  Search, \r\n  PlusCircle, \r\n  Library, \r\n  User, \r\n  LogOut, \r\n  RefreshCw, \r\n  MapPin,\r\n  Heart,\r\n  MessageSquare,\r\n  ArrowRight\r\n} from 'lucide-react';\r\n\r\n// Use the server API (file-based) instead of Firebase.\r\nconst API_BASE = '';\r\nconst BOOKS_API = `${API_BASE}/api/books`;\r\n\r\n// --- Components ---\r\n\r\nconst Navbar = ({ user, setView, currentView, handleLogin, handleLogout }) => (\r\n  <nav className=\"site-header sticky top-0 z-50 px-4 py-3\">\r\n    <div className=\"max-w-6xl mx-auto flex justify-between items-center\">\r\n      <div \r\n        className=\"flex items-center gap-2 cursor-pointer site-logo\" \r\n        onClick={() => setView('home')}\r\n      >\r\n        <div className=\"logo-badge\">\r\n          <Book className=\"w-6 h-6 text-white\" />\r\n        </div>\r\n        <span className=\"logo-text\">BookLoop</span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-6\">\r\n        <button \r\n          onClick={() => setView('browse')}\r\n          className={`text-sm font-medium transition ${currentView === 'browse' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n        >\r\n          Browse Books\r\n        </button>\r\n        <button \r\n          onClick={() => setView('chat')}\r\n          className={`text-sm font-medium transition ${currentView === 'chat' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n        >\r\n          Chat\r\n        </button>\r\n        <button onClick={() => setView('exchanges')} className={`text-sm font-medium transition ${currentView === 'exchanges' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}>Requests</button>\r\n        \r\n        {user ? (\r\n          <>\r\n            <button \r\n              onClick={() => setView('favorites')}\r\n              className={`text-sm font-medium transition flex items-center gap-1 ${currentView === 'favorites' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n            >\r\n              <Heart className=\"w-4 h-4\" />\r\n              Favorites\r\n            </button>\r\n            <button \r\n              onClick={() => setView('add')}\r\n              className={`text-sm font-medium transition flex items-center gap-1 ${currentView === 'add' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n            >\r\n              <PlusCircle className=\"w-4 h-4\" />\r\n              Add Book\r\n            </button>\r\n            <div className=\"flex items-center gap-3 pl-4 border-l\">\r\n              <button \r\n                onClick={() => setView('profile')}\r\n                className={`text-sm font-medium transition flex items-center justify-center ${currentView === 'profile' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n                title=\"Profile\"\r\n              >\r\n                <div className=\"w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-bold text-xs\">\r\n                  {(user?.id || '').slice(0,2).toUpperCase()}\r\n                </div>\r\n              </button>\r\n              {/* badge for unread */}\r\n              <div id=\"nav-unread-badge\" className=\"absolute -top-2 -right-2 bg-rose-500 text-white text-[10px] px-1 rounded-full hidden\">0</div>\r\n              <button \r\n                onClick={handleLogout}\r\n                className=\"text-gray-400 hover:text-red-500 transition\"\r\n                title=\"Logout\"\r\n              >\r\n                <LogOut className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <div className=\"flex items-center gap-3\">\r\n            <button onClick={() => setView('signin')} className=\"text-sm text-gray-700 hover:text-gray-900\">Sign In</button>\r\n            <button onClick={() => setView('signup')} className=\"bg-emerald-600 text-white px-3 py-1 rounded-md text-sm\">Sign Up</button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  </nav>\r\n);\r\n\r\nconst Hero = ({ setView, handleLogin, user }) => (\r\n  <div className=\"bg-gradient-to-b from-emerald-50 to-white pt-20 pb-24 px-4\">\r\n    <div className=\"max-w-4xl mx-auto text-center\">\r\n      <div className=\"inline-flex items-center gap-2 bg-white/6 text-emerald-300 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-6 backdrop-blur\">\r\n        <RefreshCw className=\"w-3 h-3\" />\r\n        The #1 Book Exchange Platform\r\n      </div>\r\n      <h1 className=\"text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 leading-tight\">\r\n        Give a Book. <br/>\r\n        <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500\">\r\n          Get a Book.\r\n        </span>\r\n      </h1>\r\n      <p className=\"text-xl text-gray-600 mb-10 max-w-2xl mx-auto leading-relaxed\">\r\n        Join a community of readers. Upload the books gathering dust on your shelf and swap them for your next great adventure.\r\n      </p>\r\n      <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\r\n        <button \r\n          onClick={() => setView('browse')}\r\n          className=\"neon-btn w-full sm:w-auto\"\r\n        >\r\n          Start Browsing\r\n        </button>\r\n        {!user && (\r\n          <button \r\n            onClick={handleLogin}\r\n            className=\"outline-btn w-full sm:w-auto px-8 py-4 font-bold text-lg transition\"\r\n          >\r\n            Join Now\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Stats */}\r\n      <div className=\"mt-16 grid grid-cols-3 gap-8 max-w-2xl mx-auto border-t pt-8\">\r\n        <div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">2k+</div>\r\n          <div className=\"text-sm text-gray-500 mt-1\">Active Readers</div>\r\n        </div>\r\n        <div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">5k+</div>\r\n          <div className=\"text-sm text-gray-500 mt-1\">Books Swapped</div>\r\n        </div>\r\n        <div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">100%</div>\r\n          <div className=\"text-sm text-gray-500 mt-1\">Free to Join</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst BookCard = ({ book, user, handleExchange, handleChat, isFavorited, onToggleFavorite }) => {\r\n  return (\r\n    <div className=\"group fancy-card animate-tilt flex flex-col overflow-hidden h-full\">\r\n      <div className=\"h-48 overflow-hidden relative bg-gray-100\">\r\n        {book.imageUrl ? (\r\n          <img \r\n            src={book.imageUrl} \r\n            alt={book.title} \r\n            className=\"w-full h-full object-cover transition duration-500 group-hover:scale-105\"\r\n            onError={(e) => {\r\n              e.target.src = 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?auto=format&fit=crop&q=80&w=2730';\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center text-gray-300 bg-slate-50\">\r\n            <Book className=\"w-16 h-16\" />\r\n          </div>\r\n        )}\r\n        <div className=\"absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-bold text-gray-700 shadow-sm\">\r\n          {book.condition}\r\n        </div>\r\n        {user && onToggleFavorite && (\r\n          <button\r\n            onClick={() => onToggleFavorite(book.id)}\r\n            className=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm p-2 rounded-md hover:bg-white transition shadow-sm\"\r\n            title={isFavorited ? 'Remove from favorites' : 'Add to favorites'}\r\n          >\r\n            <Heart className={`w-5 h-5 ${isFavorited ? 'fill-red-500 text-red-500' : 'text-gray-400'}`} />\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      <div className=\"p-5 flex flex-col flex-grow\">\r\n        <div className=\"text-xs font-semibold text-emerald-600 mb-2 uppercase tracking-wider\">{book.genre || 'General'}</div>\r\n        <h3 className=\"text-lg font-bold text-gray-900 mb-1 leading-tight\">{book.title}</h3>\r\n        <p className=\"text-sm text-gray-500 mb-4\">by {book.author}</p>\r\n        \r\n        <div className=\"flex items-center gap-2 text-xs text-gray-400 mb-6 mt-auto\">\r\n          <MapPin className=\"w-3 h-3\" />\r\n          <span>{book.location || 'Remote'}</span>\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-between pt-4 border-t border-gray-50 mt-auto\">\r\n           <div className=\"flex items-center gap-2\">\r\n             <div className=\"w-6 h-6 rounded-full bg-gradient-to-br from-purple-400 to-indigo-500 text-[10px] text-white flex items-center justify-center\">\r\n               {book.ownerId ? book.ownerId.slice(0,2).toUpperCase() : '??'}\r\n             </div>\r\n             <span className=\"text-xs text-gray-500\">Owner</span>\r\n           </div>\r\n\r\n           {user && user.id === book.ownerId ? (\r\n             <span className=\"text-xs font-medium text-gray-400 bg-gray-100 px-3 py-1 rounded-full\">Your Book</span>\r\n           ) : (\r\n             <div className=\"card-actions\">\r\n              {book.status && book.status !== 'available' ? (\r\n                   <span className=\"glow-badge\">{book.status}</span>\r\n                 ) : (\r\n                   <button \r\n                    onClick={() => handleExchange(book)}\r\n                    disabled={book.status === 'exchanged'}\r\n                    className={`neon-btn ${book.status === 'exchanged' ? 'opacity-60 cursor-not-allowed' : ''}`}\r\n                   >\r\n                     {book.status === 'exchanged' ? 'Taken' : 'Request'}\r\n                   </button>\r\n                 )}\r\n               <button onClick={() => handleChat && handleChat(book)} className=\"text-sm px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 flex items-center gap-2\">\r\n                 <MessageSquare className=\"w-4 h-4\" />\r\n                 <span>Message</span>\r\n               </button>\r\n             </div>\r\n           )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Browse = ({ books, loading, user, handleExchange, handleChat, favorites, onToggleFavorite }) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  \r\n  const filteredBooks = books.filter(book => \r\n    book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    book.author.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-4 py-8\">\r\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-gray-900\">Explore Collection</h2>\r\n          <p className=\"text-gray-500\">Find your next favorite read.</p>\r\n        </div>\r\n        \r\n        <div className=\"relative w-full md:w-96\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n          <input \r\n            type=\"text\" \r\n            placeholder=\"Search by title or author...\" \r\n            className=\"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600\"></div>\r\n        </div>\r\n      ) : filteredBooks.length === 0 ? (\r\n        <div className=\"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200\">\r\n          <Book className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900\">No books found</h3>\r\n          <p className=\"text-gray-500\">Try adjusting your search terms.</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n          {filteredBooks.map(book => (\r\n            <BookCard key={book.id} book={book} user={user} handleExchange={handleExchange} handleChat={handleChat} isFavorited={favorites.includes(book.id)} onToggleFavorite={onToggleFavorite} />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Favorites = ({ books, loading, user, handleExchange, handleChat, favorites, onToggleFavorite }) => {\r\n  const favoriteBooks = books.filter(b => favorites.includes(b.id));\r\n  \r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-4 py-8\">\r\n      <div className=\"flex items-center gap-3 mb-8\">\r\n        <Heart className=\"w-8 h-8 text-red-500 fill-red-500\" />\r\n        <h2 className=\"text-2xl font-bold text-gray-900\">My Favorites</h2>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600\"></div>\r\n        </div>\r\n      ) : favoriteBooks.length === 0 ? (\r\n        <div className=\"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200\">\r\n          <Heart className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900\">No favorites yet</h3>\r\n          <p className=\"text-gray-500\">Click the heart icon on books you love.</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n          {favoriteBooks.map(book => (\r\n            <BookCard key={book.id} book={book} user={user} handleExchange={handleExchange} handleChat={handleChat} isFavorited={true} onToggleFavorite={onToggleFavorite} />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AddBook = ({ setView, user, token, onNotify }) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    author: '',\r\n    genre: 'Fiction',\r\n    condition: 'Good',\r\n    location: '',\r\n    imageUrl: ''\r\n  });\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!user) return;\r\n    setLoading(true);\r\n\r\n    try {\r\n      // Post to server\r\n      await fetch(BOOKS_API, { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: token ? `Bearer ${token}` : '' }, body: JSON.stringify({ ...formData, ownerId: user.id }) });\r\n      setView('browse');\r\n      if (onNotify) onNotify('Book added successfully!', 'success');\r\n    } catch (error) {\r\n      console.error(\"Error adding book:\", error);\r\n      if (onNotify) onNotify(\"Failed to add book. Try again.\", 'error');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded-2xl shadow-lg border border-gray-100\">\r\n        <div className=\"flex items-center gap-3 mb-8\">\r\n          <div className=\"bg-emerald-100 p-3 rounded-full\">\r\n            <PlusCircle className=\"w-6 h-6 text-emerald-600\" />\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold text-gray-900\">List a Book</h2>\r\n            <p className=\"text-gray-500 text-sm\">Share a book with the community</p>\r\n          </div>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Book Title</label>\r\n              <input \r\n                required\r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n                placeholder=\"e.g. The Great Gatsby\"\r\n                value={formData.title}\r\n                onChange={e => setFormData({...formData, title: e.target.value})}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Author</label>\r\n              <input \r\n                required\r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n                placeholder=\"e.g. F. Scott Fitzgerald\"\r\n                value={formData.author}\r\n                onChange={e => setFormData({...formData, author: e.target.value})}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Genre</label>\r\n              <select \r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\"\r\n                value={formData.genre}\r\n                onChange={e => setFormData({...formData, genre: e.target.value})}\r\n              >\r\n                <option>Fiction</option>\r\n                <option>Non-Fiction</option>\r\n                <option>Sci-Fi</option>\r\n                <option>Mystery</option>\r\n                <option>Biography</option>\r\n                <option>Textbook</option>\r\n              </select>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Condition</label>\r\n              <select \r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\"\r\n                value={formData.condition}\r\n                onChange={e => setFormData({...formData, condition: e.target.value})}\r\n              >\r\n                <option>New</option>\r\n                <option>Like New</option>\r\n                <option>Good</option>\r\n                <option>Fair</option>\r\n                <option>Poor</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-semibold text-gray-700\">Cover Image URL</label>\r\n            <input \r\n              type=\"url\"\r\n              className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n              placeholder=\"https://example.com/image.jpg\"\r\n              value={formData.imageUrl}\r\n              onChange={e => setFormData({...formData, imageUrl: e.target.value})}\r\n            />\r\n            <p className=\"text-xs text-gray-500\">Tip: Search Google Images, right click image, \"Copy Image Address\"</p>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-semibold text-gray-700\">City/Location</label>\r\n            <input \r\n              required\r\n              className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n              placeholder=\"e.g. New York, NY\"\r\n              value={formData.location}\r\n              onChange={e => setFormData({...formData, location: e.target.value})}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"pt-4 flex gap-4\">\r\n            <button \r\n              type=\"button\"\r\n              onClick={() => setView('browse')}\r\n              className=\"flex-1 px-6 py-3 border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button \r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"flex-1 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl shadow-lg shadow-emerald-200 transition flex justify-center items-center\"\r\n            >\r\n              {loading ? <span className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></span> : 'List Book'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- Main App Component ---\r\n\r\nexport default function App() {\r\n  const [user, setUser] = useState(null);\r\n  const [books, setBooks] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [currentView, setCurrentView] = useState('home'); // home, browse, add, favorites, chat, exchanges, profile\r\n  const [notification, setNotification] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [conversationId, setConversationId] = useState(null);\r\n  const [exchanges, setExchanges] = useState([]);\r\n  const [unreadTotal, setUnreadTotal] = useState(0);\r\n  const [favorites, setFavorites] = useState([]);\r\n\r\n  const apiFetch = (url, opts = {}) => {\r\n    const headers = opts.headers || {};\r\n    if (token) headers['Authorization'] = `Bearer ${token}`;\r\n    return fetch(url, { ...opts, headers });\r\n  };\r\n\r\n  // 1. Auth Handling (JWT stored in localStorage)\r\n  useEffect(() => {\r\n    const t = localStorage.getItem('be_token');\r\n    const u = localStorage.getItem('be_user');\r\n    if (t) setToken(t);\r\n    if (u) setUser(JSON.parse(u));\r\n    // verify token and refresh user\r\n    if (t) {\r\n      fetch('/api/me', { headers: { Authorization: `Bearer ${t}` } })\r\n        .then(r => r.json())\r\n        .then(data => { if (!data.error) { setUser(data); localStorage.setItem('be_user', JSON.stringify(data)); } else { localStorage.removeItem('be_token'); localStorage.removeItem('be_user'); setToken(null); setUser(null); } })\r\n        .catch(() => {});\r\n    }\r\n  }, []);\r\n\r\n  // 2. Data Fetching\r\n  const fetchBooks = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(BOOKS_API);\r\n      const data = await res.json();\r\n      setBooks(data || []);\r\n    } catch (err) {\r\n      console.error('Fetch books error', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchExchanges = async () => {\r\n    if (!token) return setExchanges([]);\r\n    try {\r\n      const res = await apiFetch('/api/exchanges');\r\n      const data = await res.json();\r\n      setExchanges(data || []);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  const fetchFavorites = async () => {\r\n    if (!token) return setFavorites([]);\r\n    try {\r\n      const res = await apiFetch('/api/users/favorites');\r\n      const data = await res.json();\r\n      if (data && !data.error) {\r\n        setFavorites(data.map(b => b.id) || []);\r\n      }\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  const handleToggleFavorite = async (bookId) => {\r\n    if (!token) return;\r\n    try {\r\n      const res = await apiFetch('/api/users/favorite', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ bookId }) });\r\n      const data = await res.json();\r\n      if (data.favorites) {\r\n        setFavorites(data.favorites);\r\n        const isFav = data.favorites.includes(bookId);\r\n        showNotification(isFav ? 'Added to favorites' : 'Removed from favorites', 'success');\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      showNotification('Failed to update favorite', 'error');\r\n    }\r\n  };\r\n\r\n  useEffect(() => { fetchBooks(); }, []);\r\n  useEffect(() => { fetchExchanges(); }, [token]);\r\n  useEffect(() => { fetchFavorites(); }, [token]);\r\n  useEffect(() => {\r\n    // compute unread total from conversations\r\n    async function compute() {\r\n      if (!token) return setUnreadTotal(0);\r\n      try {\r\n        const r = await fetch('/api/conversations', { headers: { Authorization: `Bearer ${token}` } });\r\n        const d = await r.json();\r\n        const total = (d || []).reduce((s, c) => s + (c.unreadCount || 0), 0);\r\n        setUnreadTotal(total);\r\n        // update navbar badge\r\n        const badge = document.getElementById('nav-unread-badge');\r\n        if (badge) {\r\n          if (total > 0) { badge.textContent = total; badge.classList.remove('hidden'); }\r\n          else { badge.classList.add('hidden'); }\r\n        }\r\n      } catch (e) { console.error(e); }\r\n    }\r\n    compute();\r\n  }, [token, conversationId]);\r\n\r\n  // Actions\r\n  const handleLogin = () => setCurrentView('signin');\r\n\r\n  const doSignup = async (name, email, password) => {\r\n    try {\r\n      const res = await fetch('/api/signup', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, email, password }) });\r\n      const data = await res.json();\r\n      if (data.token) {\r\n        localStorage.setItem('be_token', data.token);\r\n        localStorage.setItem('be_user', JSON.stringify(data.user));\r\n        setToken(data.token);\r\n        setUser(data.user);\r\n        setCurrentView('browse');\r\n        showNotification('Account created', 'success');\r\n      } else {\r\n        showNotification(data.error || 'Signup failed', 'error');\r\n      }\r\n    } catch (err) { showNotification('Signup failed', 'error'); }\r\n  };\r\n\r\n  const doLogin = async (email, password) => {\r\n    try {\r\n      const res = await fetch('/api/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });\r\n      const data = await res.json();\r\n      if (data.token) {\r\n        localStorage.setItem('be_token', data.token);\r\n        localStorage.setItem('be_user', JSON.stringify(data.user));\r\n        setToken(data.token);\r\n        setUser(data.user);\r\n        setCurrentView('browse');\r\n        showNotification('Signed in', 'success');\r\n      } else {\r\n        showNotification(data.error || 'Login failed', 'error');\r\n      }\r\n    } catch (err) { showNotification('Login failed', 'error'); }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('be_user');\r\n    localStorage.removeItem('be_token');\r\n    setUser(null);\r\n    setToken(null);\r\n    setCurrentView('home');\r\n    showNotification('Logged out', 'default');\r\n  };\r\n\r\n  const handleExchange = async (book) => {\r\n    if (!user) { showNotification('Please sign in to request books.', 'error'); return; }\r\n    if (!confirm(`Request to exchange \"${book.title}\"?`)) return;\r\n    try {\r\n      // create an exchange request (server will create/get conversation)\r\n      const res = await apiFetch('/api/exchanges', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ bookId: book.id, message: `I'd like to request ${book.title}` }) });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || 'Failed to create exchange');\r\n      const conv = data.conversation || data.conversationId || data.conversation?.id || (data.conversation && data.conversation.id ? data.conversation : null);\r\n      if (conv && conv.id) {\r\n        setConversationId(conv.id);\r\n        setCurrentView('chat');\r\n      } else if (data.conversation && data.conversation.id) {\r\n        setConversationId(data.conversation.id);\r\n        setCurrentView('chat');\r\n      }\r\n      showNotification('Request sent and private chat opened.', 'success');\r\n      fetchBooks();\r\n      fetchExchanges();\r\n    } catch (err) {\r\n      console.error(err);\r\n      showNotification('Failed to process exchange.', 'error');\r\n    }\r\n  };\r\n\r\n  const handleChat = async (book) => {\r\n    if (!user) { showNotification('Please sign in to chat with owners.', 'error'); setCurrentView('signin'); return; }\r\n    try {\r\n      const res = await apiFetch('/api/conversations', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ otherUserId: book.ownerId, bookId: book.id }) });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || 'Failed to create conversation');\r\n      const conv = data || null;\r\n      if (conv && conv.id) {\r\n        setConversationId(conv.id);\r\n        setCurrentView('chat');\r\n      }\r\n      showNotification('Private chat opened with owner.', 'success');\r\n    } catch (err) {\r\n      console.error(err);\r\n      showNotification('Failed to open chat.', 'error');\r\n    }\r\n  };\r\n\r\n  const showNotification = (message, type = 'default') => {\r\n    setNotification({ message, type });\r\n    setTimeout(() => setNotification(null), 3000);\r\n  };\r\n\r\n  // Helper for View Rendering\r\n  const renderView = () => {\r\n    switch (currentView) {\r\n      case 'home':\r\n        return <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n      case 'browse':\r\n        return <Browse books={books} loading={loading} user={user} handleExchange={handleExchange} handleChat={handleChat} favorites={favorites} onToggleFavorite={handleToggleFavorite} />;\r\n      case 'favorites':\r\n        return user ? <Favorites books={books} loading={loading} user={user} handleExchange={handleExchange} handleChat={handleChat} favorites={favorites} onToggleFavorite={handleToggleFavorite} /> : <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n      case 'add':\r\n        return user ? <AddBook setView={setCurrentView} user={user} token={token} onNotify={showNotification} /> : <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n      case 'signin':\r\n        return <SignIn onLogin={doLogin} onSwitch={() => setCurrentView('signup')} />;\r\n      case 'signup':\r\n        return <SignUp onSignup={doSignup} onSwitch={() => setCurrentView('signin')} />;\r\n      case 'chat':\r\n        return <Chat user={user} token={token} conversationId={conversationId} onSelectConversation={id => { setConversationId(id); setCurrentView('chat'); }} onLeave={() => { setConversationId(null); setCurrentView('chat'); }} />;\r\n      case 'exchanges':\r\n        return <Exchanges user={user} token={token} exchanges={exchanges} refresh={fetchExchanges} onOpenConversation={(id)=>{ setConversationId(id); setCurrentView('chat'); }} onNotify={showNotification} />;\r\n      case 'profile':\r\n        return <Profile user={user} onUpdate={(u)=>{ setUser(u); localStorage.setItem('be_user', JSON.stringify(u)); }} token={token} />;\r\n      default:\r\n        return <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen pb-10 fancy-app\">\r\n      <div className=\"bg-blob\"></div>\r\n      <Navbar \r\n        user={user} \r\n        setView={setCurrentView} \r\n        currentView={currentView}\r\n        handleLogin={handleLogin}\r\n        handleLogout={handleLogout}\r\n      />\r\n      \r\n      {/* Notification Toast */}\r\n      {notification && (\r\n        <div className={`fixed top-20 right-4 z-50 px-6 py-3 rounded-lg shadow-xl border animate-fade-in-down ${\r\n          notification.type === 'success' ? 'bg-emerald-100 border-emerald-200 text-emerald-800' :\r\n          notification.type === 'error' ? 'bg-red-100 border-red-200 text-red-800' :\r\n          'bg-gray-800 text-white'\r\n        }`}>\r\n          {notification.message}\r\n        </div>\r\n      )}\r\n\r\n      <main>\r\n        {renderView()}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\n// --- Auth / Chat / Profile UI Components ---\r\n\r\nfunction SignIn({ onLogin, onSwitch }) {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  return (\r\n    <div className=\"max-w-md mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded shadow\">\r\n        <h2 className=\"text-xl font-bold mb-4\">Sign In</h2>\r\n        <input className=\"w-full mb-2 p-2 border rounded\" placeholder=\"Email\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n        <input type=\"password\" className=\"w-full mb-4 p-2 border rounded\" placeholder=\"Password\" value={password} onChange={e=>setPassword(e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={()=>onLogin(email,password)} className=\"bg-emerald-600 text-white px-4 py-2 rounded\">Sign In</button>\r\n          <button onClick={onSwitch} className=\"px-4 py-2 border rounded\">Create Account</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SignUp({ onSignup, onSwitch }) {\r\n  const [name, setName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  return (\r\n    <div className=\"max-w-md mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded shadow\">\r\n        <h2 className=\"text-xl font-bold mb-4\">Create Account</h2>\r\n        <input className=\"w-full mb-2 p-2 border rounded\" placeholder=\"Name\" value={name} onChange={e=>setName(e.target.value)} />\r\n        <input className=\"w-full mb-2 p-2 border rounded\" placeholder=\"Email\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n        <input type=\"password\" className=\"w-full mb-4 p-2 border rounded\" placeholder=\"Password\" value={password} onChange={e=>setPassword(e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={()=>onSignup(name,email,password)} className=\"bg-emerald-600 text-white px-4 py-2 rounded\">Sign Up</button>\r\n          <button onClick={onSwitch} className=\"px-4 py-2 border rounded\">Sign In</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nimport { io as ioClient } from 'socket.io-client';\r\n\r\nfunction Chat({ user, token, conversationId, onSelectConversation, onLeave }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [text, setText] = useState('');\r\n  const [conversations, setConversations] = useState([]);\r\n  const socketRef = React.useRef(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load(){\r\n      // Only load messages if a conversation is open\r\n      if (conversationId) {\r\n        const res = await fetch(`/api/conversations/${conversationId}/messages`, { headers: { Authorization: token ? `Bearer ${token}` : '' } });\r\n        const data = await res.json();\r\n        if(mounted) setMessages(data || []);\r\n      }\r\n    }\r\n    async function loadConvs(){\r\n      if (!token) return;\r\n      const r = await fetch('/api/conversations', { headers: { Authorization: `Bearer ${token}` } });\r\n      const d = await r.json();\r\n      setConversations(d || []);\r\n    }\r\n    load();\r\n    loadConvs();\r\n\r\n    // connect socket\r\n    socketRef.current = ioClient(window.location.origin.replace(/:\\d+$/,'') + ':5000');\r\n    // identify the socket with token so server can join user-specific room\r\n    if (token) {\r\n      socketRef.current.emit('identify', token);\r\n    }\r\n    socketRef.current.on('conversationMessage', (msg) => {\r\n      // only append if it belongs to our open conversation\r\n      if (conversationId && msg.conversationId === conversationId) setMessages(prev => [...prev, msg]);\r\n      // if not open, update conversation list (unread handled server-side)\r\n      if (!conversationId) loadConvs();\r\n    });\r\n    // exchange notifications\r\n    socketRef.current.on('exchangeRequest', (ex) => {\r\n      showNotification('New exchange request', 'default');\r\n      fetchExchanges();\r\n      loadConvs();\r\n    });\r\n    socketRef.current.on('exchangeAccepted', (ex) => {\r\n      showNotification('An exchange was accepted', 'success');\r\n      fetchExchanges();\r\n      fetchBooks();\r\n    });\r\n    socketRef.current.on('exchangeDeclined', (ex) => {\r\n      showNotification('An exchange was declined', 'error');\r\n      fetchExchanges();\r\n    });\r\n\r\n    return ()=>{ mounted=false; if(socketRef.current) socketRef.current.disconnect(); };\r\n  }, [conversationId, token]);\r\n\r\n  useEffect(() => {\r\n    // when conversationId changes, join/leave socket room\r\n    if (!socketRef.current) return;\r\n    if (conversationId) {\r\n      socketRef.current.emit('joinConversation', conversationId);\r\n      // mark read on server\r\n      if (token) fetch(`/api/conversations/${conversationId}/read`, { method: 'PUT', headers: { Authorization: `Bearer ${token}` } }).catch(()=>{});\r\n    }\r\n    return () => {\r\n      if (conversationId) socketRef.current.emit('leaveConversation', conversationId);\r\n    };\r\n  }, [conversationId]);\r\n\r\n  const send = async () => {\r\n    if (!text.trim()) return;\r\n    try {\r\n      if (conversationId) {\r\n        // send via socket to conversation room\r\n        if (socketRef.current && socketRef.current.connected) {\r\n          socketRef.current.emit('sendConversationMessage', { token, text, conversationId });\r\n        } else {\r\n          await fetch(`/api/conversations/${conversationId}/messages`, { method: 'POST', headers: { 'Content-Type':'application/json', Authorization: token ? `Bearer ${token}` : '' }, body: JSON.stringify({ text }) });\r\n        }\r\n      }\r\n      setText('');\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto px-4 py-8\">\r\n      <div className=\"mb-4 flex items-center justify-between\">\r\n        <h2 className=\"text-xl font-bold\">Chat</h2>\r\n        {conversationId ? <button onClick={() => { if (onLeave) onLeave(); }} className=\"text-sm text-gray-600\">Leave</button> : null}\r\n      </div>\r\n\r\n      {!conversationId && (\r\n        <div className=\"mb-4\">\r\n          <h3 className=\"font-semibold mb-2\">Your Conversations</h3>\r\n          {conversations.length === 0 ? <div className=\"text-sm text-gray-500\">No conversations yet. Request a book to start a private chat.</div> : (\r\n            <div className=\"space-y-2\">\r\n              {conversations.map(c => (\r\n                <button key={c.id} onClick={() => onSelectConversation && onSelectConversation(c.id)} className=\"w-full text-left p-3 border rounded hover:bg-gray-50 flex items-center justify-between\">\r\n                  <div className=\"text-left\">\r\n                    <div className=\"text-sm font-medium\">Conversation about {c.bookId ? `book:${c.bookId}` : 'general'}</div>\r\n                    <div className=\"text-xs text-gray-500\">With: { (c.participantsInfo || c.participants).map(p => p.name || p).filter(Boolean).join(', ') }</div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {c.unreadCount ? <div className=\"bg-emerald-600 text-white text-xs px-2 py-1 rounded-full\">{c.unreadCount}</div> : null}\r\n                    <ArrowRight className=\"w-4 h-4 text-gray-400\" />\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"chat-glass p-4 rounded shadow h-[55vh] flex flex-col\">\r\n        <div className=\"flex-1 overflow-auto mb-4\">\r\n          {messages.map(m => (\r\n            <div key={m.id} className=\"mb-3\">\r\n              <div className=\"text-xs text-gray-500\">{m.fromName || m.from}  {new Date(m.createdAt).toLocaleTimeString()}</div>\r\n              <div className=\"bg-gray-100 inline-block p-2 rounded mt-1\">{m.text}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <input value={text} onChange={e=>setText(e.target.value)} className=\"flex-1 p-2 border rounded\" placeholder={user && conversationId ? 'Message the other participant...' : 'Select a conversation to start messaging'} disabled={!user || !conversationId} />\r\n          <button onClick={send} className=\"bg-emerald-600 text-white px-4 py-2 rounded\" disabled={!user || !conversationId}>Send</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Profile({ user, onUpdate, token }) {\r\n  const [name, setName] = useState(user?.name || '');\r\n  const [bio, setBio] = useState(user?.bio || '');\r\n  const save = async () => {\r\n    try {\r\n      if (!token) return;\r\n      const res = await fetch(`/api/users/${user.id}`, { method: 'PUT', headers: { 'Content-Type':'application/json', Authorization: `Bearer ${token}` }, body: JSON.stringify({ name, bio }) });\r\n      const data = await res.json();\r\n      if (res.ok) {\r\n        onUpdate(data);\r\n        showNotification('Profile updated', 'success');\r\n      } else {\r\n        showNotification(data.error || 'Failed to update profile', 'error');\r\n      }\r\n    } catch (e) { console.error(e); showNotification('Failed to update profile', 'error'); }\r\n  };\r\n  return (\r\n    <div className=\"max-w-md mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded shadow\">\r\n        <h2 className=\"text-xl font-bold mb-4\">Profile</h2>\r\n        <input className=\"w-full mb-2 p-2 border rounded\" value={name} onChange={e=>setName(e.target.value)} />\r\n        <textarea className=\"w-full mb-2 p-2 border rounded\" value={bio} onChange={e=>setBio(e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={save} className=\"bg-emerald-600 text-white px-4 py-2 rounded\">Save</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Exchanges({ user, token, exchanges, refresh, onOpenConversation, onNotify }) {\r\n  const accept = async (id) => {\r\n    if (!token) return;\r\n    try {\r\n      const r = await fetch(`/api/exchanges/${id}/accept`, { method: 'PUT', headers: { Authorization: `Bearer ${token}` } });\r\n      const d = await r.json();\r\n      if (r.ok) { refresh(); if (onNotify) onNotify('Exchange accepted!', 'success'); }\r\n      else if (onNotify) onNotify(d.error || 'Failed to accept', 'error');\r\n    } catch (e) { console.error(e); if (onNotify) onNotify('Failed to accept', 'error'); }\r\n  };\r\n  const decline = async (id) => {\r\n    if (!token) return;\r\n    try {\r\n      const r = await fetch(`/api/exchanges/${id}/decline`, { method: 'PUT', headers: { Authorization: `Bearer ${token}` } });\r\n      const d = await r.json();\r\n      if (r.ok) { refresh(); if (onNotify) onNotify('Exchange declined', 'success'); }\r\n      else if (onNotify) onNotify(d.error || 'Failed to decline', 'error');\r\n    } catch (e) { console.error(e); if (onNotify) onNotify('Failed to decline', 'error'); }\r\n  };\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto px-4 py-8\">\r\n      <h2 className=\"text-2xl font-bold mb-4\">Exchange Requests</h2>\r\n      {exchanges.length === 0 ? <div className=\"text-gray-500\">No exchange activity.</div> : (\r\n        <div className=\"space-y-4\">\r\n          {exchanges.map(e => (\r\n            <div key={e.id} className=\"bg-white border p-4 rounded flex justify-between items-start\">\r\n              <div>\r\n                <div className=\"text-sm text-gray-500\">Book: {e.bookId}</div>\r\n                <div className=\"font-medium\">From: {e.requesterId}  Status: <span className=\"font-semibold\">{e.status}</span></div>\r\n                <div className=\"text-sm text-gray-600 mt-2\">{e.message}</div>\r\n                <div className=\"text-xs text-gray-400 mt-2\">Requested at: {new Date(e.createdAt).toLocaleString()}</div>\r\n              </div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                {e.ownerId === user?.id && e.status === 'requested' ? (\r\n                  <>\r\n                    <button onClick={() => accept(e.id)} className=\"px-3 py-2 bg-emerald-600 text-white rounded\">Accept</button>\r\n                    <button onClick={() => decline(e.id)} className=\"px-3 py-2 border rounded\">Decline</button>\r\n                  </>\r\n                ) : null}\r\n                <button onClick={() => onOpenConversation && onOpenConversation(e.conversationId || e.conversation?.id)} className=\"px-3 py-2 bg-gray-100 rounded\">Open Chat</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}