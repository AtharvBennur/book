{"ast":null,"code":"import{useEffect,useMemo,useState}from'react';import{useNavigate}from'react-router-dom';import BookFilters from'../components/books/BookFilters';import BookGrid from'../components/books/BookGrid';import ShuffleSpotlight from'../components/books/ShuffleSpotlight';import SectionHeading from'../components/common/SectionHeading';import{useAppData}from'../context/AppDataContext';import{useAuth}from'../context/AuthContext';import{exchangesApi,conversationsApi}from'../services/api';import{useNotification}from'../context/NotificationContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Browse=()=>{const{books,booksStatus,favorites,toggleFavorite,refreshBooks,refreshExchanges,isOwner,exchanges}=useAppData();const{isAuthenticated,token,user}=useAuth();const{notify}=useNotification();const navigate=useNavigate();const[filters,setFilters]=useState({search:'',genre:'All Genres',status:'Any Status'});const[spotlightBook,setSpotlightBook]=useState(null);const filteredBooks=useMemo(()=>{return books.filter(book=>{const matchesSearch=!filters.search||book.title.toLowerCase().includes(filters.search.toLowerCase())||book.author.toLowerCase().includes(filters.search.toLowerCase());const matchesGenre=filters.genre==='All Genres'||book.genre===filters.genre;const matchesStatus=filters.status==='Any Status'||book.status===filters.status;return matchesSearch&&matchesGenre&&matchesStatus;});},[books,filters]);useEffect(()=>{if(filteredBooks.length){setSpotlightBook(filteredBooks[Math.floor(Math.random()*filteredBooks.length)]);}else{setSpotlightBook(null);}},[filteredBooks]);const shuffleSpotlight=()=>{if(!filteredBooks.length)return;setSpotlightBook(filteredBooks[Math.floor(Math.random()*filteredBooks.length)]);};const requireAuth=()=>{if(!isAuthenticated){notify('Please sign in to continue.','info');navigate('/auth/signin',{replace:true,state:{from:'/browse'}});return false;}return true;};const handleRequest=async book=>{if(!requireAuth())return;try{await exchangesApi.create({bookId:book.id,message:\"I'd love to exchange for \".concat(book.title)},token);notify('Exchange request sent.','success');refreshBooks();refreshExchanges();}catch(err){notify(err.message||'Unable to create request.','error');}};const canChatOnBook=book=>{if(!user)return false;return exchanges.some(exchange=>exchange.bookId===book.id&&[exchange.ownerId,exchange.requesterId].includes(user.id)&&[exchange.ownerId,exchange.requesterId].includes(book.ownerId));};const handleChat=async book=>{if(!requireAuth())return;if(!canChatOnBook(book)){notify('Send or accept an exchange request to unlock chat for this book.','info');return;}try{const conversation=await conversationsApi.create({otherUserId:book.ownerId,bookId:book.id},token);navigate('/chat',{state:{conversationId:conversation.id}});}catch(err){notify(err.message||'Unable to open chat.','error');}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(SectionHeading,{eyebrow:\"Browse\",title:\"Seamless marketplace for every genre\",description:\"Use filters, favorites, and quick actions to find the exact story you want to read next.\",align:\"left\"}),/*#__PURE__*/_jsx(BookFilters,{filters:filters,onChange:setFilters}),spotlightBook&&/*#__PURE__*/_jsx(ShuffleSpotlight,{book:spotlightBook,onShuffle:shuffleSpotlight}),/*#__PURE__*/_jsx(BookGrid,{books:filteredBooks,isLoading:booksStatus==='loading',favorites:favorites,onToggleFavorite:isAuthenticated?toggleFavorite:undefined,onRequestExchange:handleRequest,onChat:handleChat,isOwner:isOwner})]});};export default Browse;","map":{"version":3,"names":["useEffect","useMemo","useState","useNavigate","BookFilters","BookGrid","ShuffleSpotlight","SectionHeading","useAppData","useAuth","exchangesApi","conversationsApi","useNotification","jsx","_jsx","jsxs","_jsxs","Browse","books","booksStatus","favorites","toggleFavorite","refreshBooks","refreshExchanges","isOwner","exchanges","isAuthenticated","token","user","notify","navigate","filters","setFilters","search","genre","status","spotlightBook","setSpotlightBook","filteredBooks","filter","book","matchesSearch","title","toLowerCase","includes","author","matchesGenre","matchesStatus","length","Math","floor","random","shuffleSpotlight","requireAuth","replace","state","from","handleRequest","create","bookId","id","message","concat","err","canChatOnBook","some","exchange","ownerId","requesterId","handleChat","conversation","otherUserId","conversationId","children","eyebrow","description","align","onChange","onShuffle","isLoading","onToggleFavorite","undefined","onRequestExchange","onChat"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/pages/Browse.jsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport BookFilters from '../components/books/BookFilters';\r\nimport BookGrid from '../components/books/BookGrid';\r\nimport ShuffleSpotlight from '../components/books/ShuffleSpotlight';\r\nimport SectionHeading from '../components/common/SectionHeading';\r\nimport { useAppData } from '../context/AppDataContext';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { exchangesApi, conversationsApi } from '../services/api';\r\nimport { useNotification } from '../context/NotificationContext';\r\n\r\nconst Browse = () => {\r\n  const {\r\n    books,\r\n    booksStatus,\r\n    favorites,\r\n    toggleFavorite,\r\n    refreshBooks,\r\n    refreshExchanges,\r\n    isOwner,\r\n    exchanges,\r\n  } = useAppData();\r\n  const { isAuthenticated, token, user } = useAuth();\r\n  const { notify } = useNotification();\r\n  const navigate = useNavigate();\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    genre: 'All Genres',\r\n    status: 'Any Status',\r\n  });\r\n  const [spotlightBook, setSpotlightBook] = useState(null);\r\n\r\n  const filteredBooks = useMemo(() => {\r\n    return books.filter((book) => {\r\n      const matchesSearch =\r\n        !filters.search ||\r\n        book.title.toLowerCase().includes(filters.search.toLowerCase()) ||\r\n        book.author.toLowerCase().includes(filters.search.toLowerCase());\r\n      const matchesGenre = filters.genre === 'All Genres' || book.genre === filters.genre;\r\n      const matchesStatus = filters.status === 'Any Status' || book.status === filters.status;\r\n      return matchesSearch && matchesGenre && matchesStatus;\r\n    });\r\n  }, [books, filters]);\r\n\r\n  useEffect(() => {\r\n    if (filteredBooks.length) {\r\n      setSpotlightBook(filteredBooks[Math.floor(Math.random() * filteredBooks.length)]);\r\n    } else {\r\n      setSpotlightBook(null);\r\n    }\r\n  }, [filteredBooks]);\r\n\r\n  const shuffleSpotlight = () => {\r\n    if (!filteredBooks.length) return;\r\n    setSpotlightBook(filteredBooks[Math.floor(Math.random() * filteredBooks.length)]);\r\n  };\r\n\r\n  const requireAuth = () => {\r\n    if (!isAuthenticated) {\r\n      notify('Please sign in to continue.', 'info');\r\n      navigate('/auth/signin', { replace: true, state: { from: '/browse' } });\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleRequest = async (book) => {\r\n    if (!requireAuth()) return;\r\n    try {\r\n      await exchangesApi.create(\r\n        { bookId: book.id, message: `I'd love to exchange for ${book.title}` },\r\n        token\r\n      );\r\n      notify('Exchange request sent.', 'success');\r\n      refreshBooks();\r\n      refreshExchanges();\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to create request.', 'error');\r\n    }\r\n  };\r\n\r\n  const canChatOnBook = (book) => {\r\n    if (!user) return false;\r\n    return exchanges.some(\r\n      (exchange) =>\r\n        exchange.bookId === book.id &&\r\n        [exchange.ownerId, exchange.requesterId].includes(user.id) &&\r\n        [exchange.ownerId, exchange.requesterId].includes(book.ownerId)\r\n    );\r\n  };\r\n\r\n  const handleChat = async (book) => {\r\n    if (!requireAuth()) return;\r\n    if (!canChatOnBook(book)) {\r\n      notify('Send or accept an exchange request to unlock chat for this book.', 'info');\r\n      return;\r\n    }\r\n    try {\r\n      const conversation = await conversationsApi.create(\r\n        { otherUserId: book.ownerId, bookId: book.id },\r\n        token\r\n      );\r\n      navigate('/chat', { state: { conversationId: conversation.id } });\r\n    } catch (err) {\r\n      notify(err.message || 'Unable to open chat.', 'error');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <SectionHeading\r\n        eyebrow=\"Browse\"\r\n        title=\"Seamless marketplace for every genre\"\r\n        description=\"Use filters, favorites, and quick actions to find the exact story you want to read next.\"\r\n        align=\"left\"\r\n      />\r\n      <BookFilters filters={filters} onChange={setFilters} />\r\n      {spotlightBook && (\r\n        <ShuffleSpotlight book={spotlightBook} onShuffle={shuffleSpotlight} />\r\n      )}\r\n      <BookGrid\r\n        books={filteredBooks}\r\n        isLoading={booksStatus === 'loading'}\r\n        favorites={favorites}\r\n        onToggleFavorite={isAuthenticated ? toggleFavorite : undefined}\r\n        onRequestExchange={handleRequest}\r\n        onChat={handleChat}\r\n        isOwner={isOwner}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Browse;\r\n\r\n"],"mappings":"AAAA,OAASA,SAAS,CAAEC,OAAO,CAAEC,QAAQ,KAAQ,OAAO,CACpD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,WAAW,KAAM,iCAAiC,CACzD,MAAO,CAAAC,QAAQ,KAAM,8BAA8B,CACnD,MAAO,CAAAC,gBAAgB,KAAM,sCAAsC,CACnE,MAAO,CAAAC,cAAc,KAAM,qCAAqC,CAChE,OAASC,UAAU,KAAQ,2BAA2B,CACtD,OAASC,OAAO,KAAQ,wBAAwB,CAChD,OAASC,YAAY,CAAEC,gBAAgB,KAAQ,iBAAiB,CAChE,OAASC,eAAe,KAAQ,gCAAgC,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEjE,KAAM,CAAAC,MAAM,CAAGA,CAAA,GAAM,CACnB,KAAM,CACJC,KAAK,CACLC,WAAW,CACXC,SAAS,CACTC,cAAc,CACdC,YAAY,CACZC,gBAAgB,CAChBC,OAAO,CACPC,SACF,CAAC,CAAGjB,UAAU,CAAC,CAAC,CAChB,KAAM,CAAEkB,eAAe,CAAEC,KAAK,CAAEC,IAAK,CAAC,CAAGnB,OAAO,CAAC,CAAC,CAClD,KAAM,CAAEoB,MAAO,CAAC,CAAGjB,eAAe,CAAC,CAAC,CACpC,KAAM,CAAAkB,QAAQ,CAAG3B,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAC4B,OAAO,CAAEC,UAAU,CAAC,CAAG9B,QAAQ,CAAC,CACrC+B,MAAM,CAAE,EAAE,CACVC,KAAK,CAAE,YAAY,CACnBC,MAAM,CAAE,YACV,CAAC,CAAC,CACF,KAAM,CAACC,aAAa,CAAEC,gBAAgB,CAAC,CAAGnC,QAAQ,CAAC,IAAI,CAAC,CAExD,KAAM,CAAAoC,aAAa,CAAGrC,OAAO,CAAC,IAAM,CAClC,MAAO,CAAAiB,KAAK,CAACqB,MAAM,CAAEC,IAAI,EAAK,CAC5B,KAAM,CAAAC,aAAa,CACjB,CAACV,OAAO,CAACE,MAAM,EACfO,IAAI,CAACE,KAAK,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACb,OAAO,CAACE,MAAM,CAACU,WAAW,CAAC,CAAC,CAAC,EAC/DH,IAAI,CAACK,MAAM,CAACF,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACb,OAAO,CAACE,MAAM,CAACU,WAAW,CAAC,CAAC,CAAC,CAClE,KAAM,CAAAG,YAAY,CAAGf,OAAO,CAACG,KAAK,GAAK,YAAY,EAAIM,IAAI,CAACN,KAAK,GAAKH,OAAO,CAACG,KAAK,CACnF,KAAM,CAAAa,aAAa,CAAGhB,OAAO,CAACI,MAAM,GAAK,YAAY,EAAIK,IAAI,CAACL,MAAM,GAAKJ,OAAO,CAACI,MAAM,CACvF,MAAO,CAAAM,aAAa,EAAIK,YAAY,EAAIC,aAAa,CACvD,CAAC,CAAC,CACJ,CAAC,CAAE,CAAC7B,KAAK,CAAEa,OAAO,CAAC,CAAC,CAEpB/B,SAAS,CAAC,IAAM,CACd,GAAIsC,aAAa,CAACU,MAAM,CAAE,CACxBX,gBAAgB,CAACC,aAAa,CAACW,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,CAAGb,aAAa,CAACU,MAAM,CAAC,CAAC,CAAC,CACnF,CAAC,IAAM,CACLX,gBAAgB,CAAC,IAAI,CAAC,CACxB,CACF,CAAC,CAAE,CAACC,aAAa,CAAC,CAAC,CAEnB,KAAM,CAAAc,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,GAAI,CAACd,aAAa,CAACU,MAAM,CAAE,OAC3BX,gBAAgB,CAACC,aAAa,CAACW,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,CAAGb,aAAa,CAACU,MAAM,CAAC,CAAC,CAAC,CACnF,CAAC,CAED,KAAM,CAAAK,WAAW,CAAGA,CAAA,GAAM,CACxB,GAAI,CAAC3B,eAAe,CAAE,CACpBG,MAAM,CAAC,6BAA6B,CAAE,MAAM,CAAC,CAC7CC,QAAQ,CAAC,cAAc,CAAE,CAAEwB,OAAO,CAAE,IAAI,CAAEC,KAAK,CAAE,CAAEC,IAAI,CAAE,SAAU,CAAE,CAAC,CAAC,CACvE,MAAO,MAAK,CACd,CACA,MAAO,KAAI,CACb,CAAC,CAED,KAAM,CAAAC,aAAa,CAAG,KAAO,CAAAjB,IAAI,EAAK,CACpC,GAAI,CAACa,WAAW,CAAC,CAAC,CAAE,OACpB,GAAI,CACF,KAAM,CAAA3C,YAAY,CAACgD,MAAM,CACvB,CAAEC,MAAM,CAAEnB,IAAI,CAACoB,EAAE,CAAEC,OAAO,6BAAAC,MAAA,CAA8BtB,IAAI,CAACE,KAAK,CAAG,CAAC,CACtEf,KACF,CAAC,CACDE,MAAM,CAAC,wBAAwB,CAAE,SAAS,CAAC,CAC3CP,YAAY,CAAC,CAAC,CACdC,gBAAgB,CAAC,CAAC,CACpB,CAAE,MAAOwC,GAAG,CAAE,CACZlC,MAAM,CAACkC,GAAG,CAACF,OAAO,EAAI,2BAA2B,CAAE,OAAO,CAAC,CAC7D,CACF,CAAC,CAED,KAAM,CAAAG,aAAa,CAAIxB,IAAI,EAAK,CAC9B,GAAI,CAACZ,IAAI,CAAE,MAAO,MAAK,CACvB,MAAO,CAAAH,SAAS,CAACwC,IAAI,CAClBC,QAAQ,EACPA,QAAQ,CAACP,MAAM,GAAKnB,IAAI,CAACoB,EAAE,EAC3B,CAACM,QAAQ,CAACC,OAAO,CAAED,QAAQ,CAACE,WAAW,CAAC,CAACxB,QAAQ,CAAChB,IAAI,CAACgC,EAAE,CAAC,EAC1D,CAACM,QAAQ,CAACC,OAAO,CAAED,QAAQ,CAACE,WAAW,CAAC,CAACxB,QAAQ,CAACJ,IAAI,CAAC2B,OAAO,CAClE,CAAC,CACH,CAAC,CAED,KAAM,CAAAE,UAAU,CAAG,KAAO,CAAA7B,IAAI,EAAK,CACjC,GAAI,CAACa,WAAW,CAAC,CAAC,CAAE,OACpB,GAAI,CAACW,aAAa,CAACxB,IAAI,CAAC,CAAE,CACxBX,MAAM,CAAC,kEAAkE,CAAE,MAAM,CAAC,CAClF,OACF,CACA,GAAI,CACF,KAAM,CAAAyC,YAAY,CAAG,KAAM,CAAA3D,gBAAgB,CAAC+C,MAAM,CAChD,CAAEa,WAAW,CAAE/B,IAAI,CAAC2B,OAAO,CAAER,MAAM,CAAEnB,IAAI,CAACoB,EAAG,CAAC,CAC9CjC,KACF,CAAC,CACDG,QAAQ,CAAC,OAAO,CAAE,CAAEyB,KAAK,CAAE,CAAEiB,cAAc,CAAEF,YAAY,CAACV,EAAG,CAAE,CAAC,CAAC,CACnE,CAAE,MAAOG,GAAG,CAAE,CACZlC,MAAM,CAACkC,GAAG,CAACF,OAAO,EAAI,sBAAsB,CAAE,OAAO,CAAC,CACxD,CACF,CAAC,CAED,mBACE7C,KAAA,QAAAyD,QAAA,eACE3D,IAAA,CAACP,cAAc,EACbmE,OAAO,CAAC,QAAQ,CAChBhC,KAAK,CAAC,sCAAsC,CAC5CiC,WAAW,CAAC,0FAA0F,CACtGC,KAAK,CAAC,MAAM,CACb,CAAC,cACF9D,IAAA,CAACV,WAAW,EAAC2B,OAAO,CAAEA,OAAQ,CAAC8C,QAAQ,CAAE7C,UAAW,CAAE,CAAC,CACtDI,aAAa,eACZtB,IAAA,CAACR,gBAAgB,EAACkC,IAAI,CAAEJ,aAAc,CAAC0C,SAAS,CAAE1B,gBAAiB,CAAE,CACtE,cACDtC,IAAA,CAACT,QAAQ,EACPa,KAAK,CAAEoB,aAAc,CACrByC,SAAS,CAAE5D,WAAW,GAAK,SAAU,CACrCC,SAAS,CAAEA,SAAU,CACrB4D,gBAAgB,CAAEtD,eAAe,CAAGL,cAAc,CAAG4D,SAAU,CAC/DC,iBAAiB,CAAEzB,aAAc,CACjC0B,MAAM,CAAEd,UAAW,CACnB7C,OAAO,CAAEA,OAAQ,CAClB,CAAC,EACC,CAAC,CAEV,CAAC,CAED,cAAe,CAAAP,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}