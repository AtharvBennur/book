{"ast":null,"code":"import{createContext,useCallback,useContext,useEffect,useMemo,useState}from'react';import{booksApi,conversationsApi,exchangesApi,favoritesApi}from'../services/api';import{useAuth}from'./AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";const AppDataContext=/*#__PURE__*/createContext(null);export const AppDataProvider=_ref=>{let{children}=_ref;const{token,user}=useAuth();const[books,setBooks]=useState([]);const[booksStatus,setBooksStatus]=useState('idle');// idle | loading | ready | error\nconst[favorites,setFavorites]=useState([]);const[exchanges,setExchanges]=useState([]);const[conversations,setConversations]=useState([]);const[activeConversationId,setActiveConversationId]=useState(null);const refreshBooks=useCallback(async()=>{setBooksStatus('loading');try{const data=await booksApi.list();setBooks(data);setBooksStatus('ready');return data;}catch(err){setBooksStatus('error');throw err;}},[]);const refreshFavorites=useCallback(async()=>{if(!token){setFavorites([]);return[];}const data=await favoritesApi.list(token);setFavorites(data.map(b=>b.id));return data;},[token]);const refreshExchanges=useCallback(async()=>{if(!token){setExchanges([]);return[];}const data=await exchangesApi.list(token);setExchanges(data);return data;},[token]);const refreshConversations=useCallback(async()=>{if(!token){setConversations([]);return[];}const data=await conversationsApi.list(token);setConversations(data);return data;},[token]);useEffect(()=>{refreshBooks();},[refreshBooks]);useEffect(()=>{refreshFavorites();refreshExchanges();refreshConversations();},[token,refreshFavorites,refreshExchanges,refreshConversations]);const toggleFavorite=useCallback(async bookId=>{if(!token)throw new Error('Please sign in to save favorites.');const data=await favoritesApi.toggle(bookId,token);setFavorites(data.favorites||[]);return data.favorites||[];},[token]);const value=useMemo(()=>({books,booksStatus,refreshBooks,favorites,toggleFavorite,exchanges,refreshExchanges,conversations,refreshConversations,activeConversationId,setActiveConversationId,isOwner:book=>user&&(book===null||book===void 0?void 0:book.ownerId)===user.id}),[books,booksStatus,refreshBooks,favorites,toggleFavorite,exchanges,refreshExchanges,conversations,refreshConversations,activeConversationId,user]);return/*#__PURE__*/_jsx(AppDataContext.Provider,{value:value,children:children});};export const useAppData=()=>{const ctx=useContext(AppDataContext);if(!ctx)throw new Error('useAppData must be used within AppDataProvider');return ctx;};","map":{"version":3,"names":["createContext","useCallback","useContext","useEffect","useMemo","useState","booksApi","conversationsApi","exchangesApi","favoritesApi","useAuth","jsx","_jsx","AppDataContext","AppDataProvider","_ref","children","token","user","books","setBooks","booksStatus","setBooksStatus","favorites","setFavorites","exchanges","setExchanges","conversations","setConversations","activeConversationId","setActiveConversationId","refreshBooks","data","list","err","refreshFavorites","map","b","id","refreshExchanges","refreshConversations","toggleFavorite","bookId","Error","toggle","value","isOwner","book","ownerId","Provider","useAppData","ctx"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/context/AppDataContext.js"],"sourcesContent":["import { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  booksApi,\r\n  conversationsApi,\r\n  exchangesApi,\r\n  favoritesApi,\r\n} from '../services/api';\r\nimport { useAuth } from './AuthContext';\r\n\r\nconst AppDataContext = createContext(null);\r\n\r\nexport const AppDataProvider = ({ children }) => {\r\n  const { token, user } = useAuth();\r\n  const [books, setBooks] = useState([]);\r\n  const [booksStatus, setBooksStatus] = useState('idle'); // idle | loading | ready | error\r\n  const [favorites, setFavorites] = useState([]);\r\n  const [exchanges, setExchanges] = useState([]);\r\n  const [conversations, setConversations] = useState([]);\r\n  const [activeConversationId, setActiveConversationId] = useState(null);\r\n\r\n  const refreshBooks = useCallback(async () => {\r\n    setBooksStatus('loading');\r\n    try {\r\n      const data = await booksApi.list();\r\n      setBooks(data);\r\n      setBooksStatus('ready');\r\n      return data;\r\n    } catch (err) {\r\n      setBooksStatus('error');\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const refreshFavorites = useCallback(async () => {\r\n    if (!token) {\r\n      setFavorites([]);\r\n      return [];\r\n    }\r\n    const data = await favoritesApi.list(token);\r\n    setFavorites(data.map((b) => b.id));\r\n    return data;\r\n  }, [token]);\r\n\r\n  const refreshExchanges = useCallback(async () => {\r\n    if (!token) {\r\n      setExchanges([]);\r\n      return [];\r\n    }\r\n    const data = await exchangesApi.list(token);\r\n    setExchanges(data);\r\n    return data;\r\n  }, [token]);\r\n\r\n  const refreshConversations = useCallback(async () => {\r\n    if (!token) {\r\n      setConversations([]);\r\n      return [];\r\n    }\r\n    const data = await conversationsApi.list(token);\r\n    setConversations(data);\r\n    return data;\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    refreshBooks();\r\n  }, [refreshBooks]);\r\n\r\n  useEffect(() => {\r\n    refreshFavorites();\r\n    refreshExchanges();\r\n    refreshConversations();\r\n  }, [token, refreshFavorites, refreshExchanges, refreshConversations]);\r\n\r\n  const toggleFavorite = useCallback(\r\n    async (bookId) => {\r\n      if (!token) throw new Error('Please sign in to save favorites.');\r\n      const data = await favoritesApi.toggle(bookId, token);\r\n      setFavorites(data.favorites || []);\r\n      return data.favorites || [];\r\n    },\r\n    [token]\r\n  );\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      books,\r\n      booksStatus,\r\n      refreshBooks,\r\n      favorites,\r\n      toggleFavorite,\r\n      exchanges,\r\n      refreshExchanges,\r\n      conversations,\r\n      refreshConversations,\r\n      activeConversationId,\r\n      setActiveConversationId,\r\n      isOwner: (book) => user && book?.ownerId === user.id,\r\n    }),\r\n    [\r\n      books,\r\n      booksStatus,\r\n      refreshBooks,\r\n      favorites,\r\n      toggleFavorite,\r\n      exchanges,\r\n      refreshExchanges,\r\n      conversations,\r\n      refreshConversations,\r\n      activeConversationId,\r\n      user,\r\n    ]\r\n  );\r\n\r\n  return <AppDataContext.Provider value={value}>{children}</AppDataContext.Provider>;\r\n};\r\n\r\nexport const useAppData = () => {\r\n  const ctx = useContext(AppDataContext);\r\n  if (!ctx) throw new Error('useAppData must be used within AppDataProvider');\r\n  return ctx;\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}