{"ast":null,"code":"import{createContext,useCallback,useContext,useEffect,useMemo,useState}from'react';import{authApi}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(()=>{try{const stored=localStorage.getItem('be_user');return stored?JSON.parse(stored):null;}catch(_unused){return null;}});const[token,setToken]=useState(()=>localStorage.getItem('be_token'));const[status,setStatus]=useState('bootstrapping');// bootstrapping | ready\nconst[error,setError]=useState(null);const persist=(nextToken,nextUser)=>{if(nextToken){localStorage.setItem('be_token',nextToken);setToken(nextToken);}if(nextUser){localStorage.setItem('be_user',JSON.stringify(nextUser));setUser(nextUser);}};const clearSession=useCallback(()=>{localStorage.removeItem('be_token');localStorage.removeItem('be_user');setToken(null);setUser(null);},[]);const bootstrap=useCallback(async()=>{if(!token){setStatus('ready');return;}try{const profile=await authApi.me(token);persist(token,profile);}catch(err){clearSession();}finally{setStatus('ready');}},[token,clearSession]);useEffect(()=>{bootstrap();},[bootstrap]);const login=useCallback(async(email,password)=>{setError(null);const{token:nextToken,user:nextUser}=await authApi.login({email,password});persist(nextToken,nextUser);return nextUser;},[]);const signup=useCallback(async payload=>{setError(null);const{token:nextToken,user:nextUser}=await authApi.signup(payload);persist(nextToken,nextUser);return nextUser;},[]);const logout=useCallback(()=>{clearSession();setStatus('ready');},[clearSession]);const updateProfile=useCallback(async payload=>{if(!token||!user)throw new Error('Not authenticated');const updated=await authApi.updateProfile(user.id,payload,token);persist(token,updated);return updated;},[token,user]);const value=useMemo(()=>({user,token,status,isAuthenticated:Boolean(user),error,login,signup,logout,updateProfile,refreshProfile:bootstrap}),[user,token,status,error,login,signup,logout,updateProfile,bootstrap]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const ctx=useContext(AuthContext);if(!ctx){throw new Error('useAuth must be used within AuthProvider');}return ctx;};","map":{"version":3,"names":["createContext","useCallback","useContext","useEffect","useMemo","useState","authApi","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","stored","localStorage","getItem","JSON","parse","_unused","token","setToken","status","setStatus","error","setError","persist","nextToken","nextUser","setItem","stringify","clearSession","removeItem","bootstrap","profile","me","err","login","email","password","signup","payload","logout","updateProfile","Error","updated","id","value","isAuthenticated","Boolean","refreshProfile","Provider","useAuth","ctx"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';\r\nimport { authApi } from '../services/api';\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(() => {\r\n    try {\r\n      const stored = localStorage.getItem('be_user');\r\n      return stored ? JSON.parse(stored) : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  });\r\n  const [token, setToken] = useState(() => localStorage.getItem('be_token'));\r\n  const [status, setStatus] = useState('bootstrapping'); // bootstrapping | ready\r\n  const [error, setError] = useState(null);\r\n\r\n  const persist = (nextToken, nextUser) => {\r\n    if (nextToken) {\r\n      localStorage.setItem('be_token', nextToken);\r\n      setToken(nextToken);\r\n    }\r\n    if (nextUser) {\r\n      localStorage.setItem('be_user', JSON.stringify(nextUser));\r\n      setUser(nextUser);\r\n    }\r\n  };\r\n\r\n  const clearSession = useCallback(() => {\r\n    localStorage.removeItem('be_token');\r\n    localStorage.removeItem('be_user');\r\n    setToken(null);\r\n    setUser(null);\r\n  }, []);\r\n\r\n  const bootstrap = useCallback(async () => {\r\n    if (!token) {\r\n      setStatus('ready');\r\n      return;\r\n    }\r\n    try {\r\n      const profile = await authApi.me(token);\r\n      persist(token, profile);\r\n    } catch (err) {\r\n      clearSession();\r\n    } finally {\r\n      setStatus('ready');\r\n    }\r\n  }, [token, clearSession]);\r\n\r\n  useEffect(() => {\r\n    bootstrap();\r\n  }, [bootstrap]);\r\n\r\n  const login = useCallback(\r\n    async (email, password) => {\r\n      setError(null);\r\n      const { token: nextToken, user: nextUser } = await authApi.login({ email, password });\r\n      persist(nextToken, nextUser);\r\n      return nextUser;\r\n    },\r\n    []\r\n  );\r\n\r\n  const signup = useCallback(\r\n    async (payload) => {\r\n      setError(null);\r\n      const { token: nextToken, user: nextUser } = await authApi.signup(payload);\r\n      persist(nextToken, nextUser);\r\n      return nextUser;\r\n    },\r\n    []\r\n  );\r\n\r\n  const logout = useCallback(() => {\r\n    clearSession();\r\n    setStatus('ready');\r\n  }, [clearSession]);\r\n\r\n  const updateProfile = useCallback(\r\n    async (payload) => {\r\n      if (!token || !user) throw new Error('Not authenticated');\r\n      const updated = await authApi.updateProfile(user.id, payload, token);\r\n      persist(token, updated);\r\n      return updated;\r\n    },\r\n    [token, user]\r\n  );\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      user,\r\n      token,\r\n      status,\r\n      isAuthenticated: Boolean(user),\r\n      error,\r\n      login,\r\n      signup,\r\n      logout,\r\n      updateProfile,\r\n      refreshProfile: bootstrap,\r\n    }),\r\n    [user, token, status, error, login, signup, logout, updateProfile, bootstrap]\r\n  );\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) {\r\n    throw new Error('useAuth must be used within AuthProvider');\r\n  }\r\n  return ctx;\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}