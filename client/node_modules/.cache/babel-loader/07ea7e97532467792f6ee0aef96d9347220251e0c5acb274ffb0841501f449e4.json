{"ast":null,"code":"import _objectSpread from\"C:/Users/dell/Desktop/pro/book-exchange-app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Book,Search,PlusCircle,Library,User,LogOut,RefreshCw,MapPin,Heart,MessageSquare,ArrowRight}from'lucide-react';// Use the server API (file-based) instead of Firebase.\nconst API_BASE='';const BOOKS_API=\"\".concat(API_BASE,\"/api/books\");// --- Components ---\nconst Navbar=_ref=>{let{user,setView,currentView,handleLogin,handleLogout}=_ref;return/*#__PURE__*/_jsx(\"nav\",{className:\"site-header sticky top-0 z-50 px-4 py-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 cursor-pointer site-logo\",onClick:()=>setView('home'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo-badge\",children:/*#__PURE__*/_jsx(Book,{className:\"w-6 h-6 text-white\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"logo-text\",children:\"BookLoop\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('browse'),className:\"text-sm font-medium transition \".concat(currentView==='browse'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:\"Browse Books\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('chat'),className:\"text-sm font-medium transition \".concat(currentView==='chat'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:\"Chat\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('exchanges'),className:\"text-sm font-medium transition \".concat(currentView==='exchanges'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:\"Requests\"}),user?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setView('add'),className:\"text-sm font-medium transition flex items-center gap-1 \".concat(currentView==='add'?'text-emerald-600':'text-gray-500 hover:text-gray-800'),children:[/*#__PURE__*/_jsx(PlusCircle,{className:\"w-4 h-4\"}),\"Add Book\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 pl-4 border-l\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-bold text-xs\",children:((user===null||user===void 0?void 0:user.id)||'').slice(0,2).toUpperCase()}),/*#__PURE__*/_jsx(\"div\",{id:\"nav-unread-badge\",className:\"absolute -top-2 -right-2 bg-rose-500 text-white text-[10px] px-1 rounded-full hidden\",children:\"0\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"text-gray-400 hover:text-red-500 transition\",title:\"Logout\",children:/*#__PURE__*/_jsx(LogOut,{className:\"w-5 h-5\"})})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('signin'),className:\"text-sm text-gray-700 hover:text-gray-900\",children:\"Sign In\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('signup'),className:\"bg-emerald-600 text-white px-3 py-1 rounded-md text-sm\",children:\"Sign Up\"})]})]})]})});};const Hero=_ref2=>{let{setView,handleLogin,user}=_ref2;return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-b from-emerald-50 to-white pt-20 pb-24 px-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center gap-2 bg-white/6 text-emerald-300 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-6 backdrop-blur\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3\"}),\"The #1 Book Exchange Platform\"]}),/*#__PURE__*/_jsxs(\"h1\",{className:\"text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 leading-tight\",children:[\"Give a Book. \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500\",children:\"Get a Book.\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-gray-600 mb-10 max-w-2xl mx-auto leading-relaxed\",children:\"Join a community of readers. Upload the books gathering dust on your shelf and swap them for your next great adventure.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row items-center justify-center gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('browse'),className:\"neon-btn w-full sm:w-auto\",children:\"Start Browsing\"}),!user&&/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,className:\"outline-btn w-full sm:w-auto px-8 py-4 font-bold text-lg transition\",children:\"Join Now\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-16 grid grid-cols-3 gap-8 max-w-2xl mx-auto border-t pt-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-gray-900\",children:\"2k+\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:\"Active Readers\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-gray-900\",children:\"5k+\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:\"Books Swapped\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-gray-900\",children:\"100%\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:\"Free to Join\"})]})]})]})});};const BookCard=_ref3=>{let{book,user,handleExchange,handleChat}=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"group fancy-card animate-tilt flex flex-col overflow-hidden h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"h-48 overflow-hidden relative bg-gray-100\",children:[book.imageUrl?/*#__PURE__*/_jsx(\"img\",{src:book.imageUrl,alt:book.title,className:\"w-full h-full object-cover transition duration-500 group-hover:scale-105\",onError:e=>{e.target.src='https://images.unsplash.com/photo-1543002588-bfa74002ed7e?auto=format&fit=crop&q=80&w=2730';}}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-full flex items-center justify-center text-gray-300 bg-slate-50\",children:/*#__PURE__*/_jsx(Book,{className:\"w-16 h-16\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-bold text-gray-700 shadow-sm\",children:book.condition})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-5 flex flex-col flex-grow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-semibold text-emerald-600 mb-2 uppercase tracking-wider\",children:book.genre||'General'}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold text-gray-900 mb-1 leading-tight\",children:book.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mb-4\",children:[\"by \",book.author]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs text-gray-400 mb-6 mt-auto\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-3 h-3\"}),/*#__PURE__*/_jsx(\"span\",{children:book.location||'Remote'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between pt-4 border-t border-gray-50 mt-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 rounded-full bg-gradient-to-br from-purple-400 to-indigo-500 text-[10px] text-white flex items-center justify-center\",children:book.ownerId?book.ownerId.slice(0,2).toUpperCase():'??'}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500\",children:\"Owner\"})]}),user&&user.id===book.ownerId?/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-medium text-gray-400 bg-gray-100 px-3 py-1 rounded-full\",children:\"Your Book\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[book.status&&book.status!=='available'?/*#__PURE__*/_jsx(\"span\",{className:\"glow-badge\",children:book.status}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleExchange(book),disabled:book.status==='exchanged',className:\"neon-btn \".concat(book.status==='exchanged'?'opacity-60 cursor-not-allowed':''),children:book.status==='exchanged'?'Taken':'Request'}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleChat&&handleChat(book),className:\"text-sm px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(MessageSquare,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Message\"})]})]})]})]})]});};const Browse=_ref4=>{let{books,loading,user,handleExchange,handleChat}=_ref4;const[searchTerm,setSearchTerm]=useState('');const filteredBooks=books.filter(book=>book.title.toLowerCase().includes(searchTerm.toLowerCase())||book.author.toLowerCase().includes(searchTerm.toLowerCase()));return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Explore Collection\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Find your next favorite read.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative w-full md:w-96\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by title or author...\",className:\"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]})]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600\"})}):filteredBooks.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200\",children:[/*#__PURE__*/_jsx(Book,{className:\"w-12 h-12 text-gray-300 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"No books found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Try adjusting your search terms.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:filteredBooks.map(book=>/*#__PURE__*/_jsx(BookCard,{book:book,user:user,handleExchange:handleExchange,handleChat:handleChat},book.id))})]});};const AddBook=_ref5=>{let{setView,user,token}=_ref5;const[loading,setLoading]=useState(false);const[formData,setFormData]=useState({title:'',author:'',genre:'Fiction',condition:'Good',location:'',imageUrl:''});const handleSubmit=async e=>{e.preventDefault();if(!user)return;setLoading(true);try{// Post to server\nawait fetch(BOOKS_API,{method:'POST',headers:{'Content-Type':'application/json',Authorization:token?\"Bearer \".concat(token):''},body:JSON.stringify(_objectSpread(_objectSpread({},formData),{},{ownerId:user.id}))});setView('browse');}catch(error){console.error(\"Error adding book:\",error);alert(\"Failed to add book. Try again.\");}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded-2xl shadow-lg border border-gray-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-emerald-100 p-3 rounded-full\",children:/*#__PURE__*/_jsx(PlusCircle,{className:\"w-6 h-6 text-emerald-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"List a Book\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm\",children:\"Share a book with the community\"})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Book Title\"}),/*#__PURE__*/_jsx(\"input\",{required:true,className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"e.g. The Great Gatsby\",value:formData.title,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{title:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Author\"}),/*#__PURE__*/_jsx(\"input\",{required:true,className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"e.g. F. Scott Fitzgerald\",value:formData.author,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{author:e.target.value}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Genre\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\",value:formData.genre,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{genre:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{children:\"Fiction\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Non-Fiction\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Sci-Fi\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Mystery\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Biography\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Textbook\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Condition\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\",value:formData.condition,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{condition:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{children:\"New\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Like New\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Good\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Fair\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Poor\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"Cover Image URL\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"https://example.com/image.jpg\",value:formData.imageUrl,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{imageUrl:e.target.value}))}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Tip: Search Google Images, right click image, \\\"Copy Image Address\\\"\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-semibold text-gray-700\",children:\"City/Location\"}),/*#__PURE__*/_jsx(\"input\",{required:true,className:\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\",placeholder:\"e.g. New York, NY\",value:formData.location,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{location:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-4 flex gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setView('browse'),className:\"flex-1 px-6 py-3 border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"flex-1 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl shadow-lg shadow-emerald-200 transition flex justify-center items-center\",children:loading?/*#__PURE__*/_jsx(\"span\",{className:\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"}):'List Book'})]})]})]})});};// --- Main App Component ---\nexport default function App(){const[user,setUser]=useState(null);const[books,setBooks]=useState([]);const[loading,setLoading]=useState(true);const[currentView,setCurrentView]=useState('home');// home, browse, add\nconst[notification,setNotification]=useState(null);const[token,setToken]=useState(null);const[conversationId,setConversationId]=useState(null);const[exchanges,setExchanges]=useState([]);const[unreadTotal,setUnreadTotal]=useState(0);const apiFetch=function(url){let opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const headers=opts.headers||{};if(token)headers['Authorization']=\"Bearer \".concat(token);return fetch(url,_objectSpread(_objectSpread({},opts),{},{headers}));};// 1. Auth Handling (JWT stored in localStorage)\nuseEffect(()=>{const t=localStorage.getItem('be_token');const u=localStorage.getItem('be_user');if(t)setToken(t);if(u)setUser(JSON.parse(u));// verify token and refresh user\nif(t){fetch('/api/me',{headers:{Authorization:\"Bearer \".concat(t)}}).then(r=>r.json()).then(data=>{if(!data.error){setUser(data);localStorage.setItem('be_user',JSON.stringify(data));}else{localStorage.removeItem('be_token');localStorage.removeItem('be_user');setToken(null);setUser(null);}}).catch(()=>{});}},[]);// 2. Data Fetching\nconst fetchBooks=async()=>{setLoading(true);try{const res=await fetch(BOOKS_API);const data=await res.json();setBooks(data||[]);}catch(err){console.error('Fetch books error',err);}finally{setLoading(false);}};const fetchExchanges=async()=>{if(!token)return setExchanges([]);try{const res=await apiFetch('/api/exchanges');const data=await res.json();setExchanges(data||[]);}catch(e){console.error(e);}};useEffect(()=>{fetchBooks();},[]);useEffect(()=>{fetchExchanges();},[token]);useEffect(()=>{// compute unread total from conversations\nasync function compute(){if(!token)return setUnreadTotal(0);try{const r=await fetch('/api/conversations',{headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();const total=(d||[]).reduce((s,c)=>s+(c.unreadCount||0),0);setUnreadTotal(total);// update navbar badge\nconst badge=document.getElementById('nav-unread-badge');if(badge){if(total>0){badge.textContent=total;badge.classList.remove('hidden');}else{badge.classList.add('hidden');}}}catch(e){console.error(e);}}compute();},[token,conversationId]);// Actions\nconst handleLogin=()=>setCurrentView('signin');const doSignup=async(name,email,password)=>{try{const res=await fetch('/api/signup',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,password})});const data=await res.json();if(data.token){localStorage.setItem('be_token',data.token);localStorage.setItem('be_user',JSON.stringify(data.user));setToken(data.token);setUser(data.user);setCurrentView('browse');showNotification('Account created','success');}else{showNotification(data.error||'Signup failed','error');}}catch(err){showNotification('Signup failed','error');}};const doLogin=async(email,password)=>{try{const res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await res.json();if(data.token){localStorage.setItem('be_token',data.token);localStorage.setItem('be_user',JSON.stringify(data.user));setToken(data.token);setUser(data.user);setCurrentView('browse');showNotification('Signed in','success');}else{showNotification(data.error||'Login failed','error');}}catch(err){showNotification('Login failed','error');}};const handleLogout=()=>{localStorage.removeItem('be_user');localStorage.removeItem('be_token');setUser(null);setToken(null);setCurrentView('home');showNotification('Logged out','default');};const handleExchange=async book=>{if(!user){showNotification('Please sign in to request books.','error');return;}if(!confirm(\"Request to exchange \\\"\".concat(book.title,\"\\\"?\")))return;try{var _data$conversation;// create an exchange request (server will create/get conversation)\nconst res=await apiFetch('/api/exchanges',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({bookId:book.id,message:\"I'd like to request \".concat(book.title)})});const data=await res.json();if(!res.ok)throw new Error(data.error||'Failed to create exchange');const conv=data.conversation||data.conversationId||((_data$conversation=data.conversation)===null||_data$conversation===void 0?void 0:_data$conversation.id)||(data.conversation&&data.conversation.id?data.conversation:null);if(conv&&conv.id){setConversationId(conv.id);setCurrentView('chat');}else if(data.conversation&&data.conversation.id){setConversationId(data.conversation.id);setCurrentView('chat');}showNotification('Request sent and private chat opened.','success');fetchBooks();fetchExchanges();}catch(err){console.error(err);showNotification('Failed to process exchange.','error');}};const handleChat=async book=>{if(!user){showNotification('Please sign in to chat with owners.','error');setCurrentView('signin');return;}try{const res=await apiFetch('/api/conversations',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({otherUserId:book.ownerId,bookId:book.id})});const data=await res.json();if(!res.ok)throw new Error(data.error||'Failed to create conversation');const conv=data||null;if(conv&&conv.id){setConversationId(conv.id);setCurrentView('chat');}showNotification('Private chat opened with owner.','success');}catch(err){console.error(err);showNotification('Failed to open chat.','error');}};const showNotification=function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'default';setNotification({message,type});setTimeout(()=>setNotification(null),3000);};// Helper for View Rendering\nconst renderView=()=>{switch(currentView){case'home':return/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});case'browse':return/*#__PURE__*/_jsx(Browse,{books:books,loading:loading,user:user,handleExchange:handleExchange,handleChat:handleChat});case'add':return user?/*#__PURE__*/_jsx(AddBook,{setView:setCurrentView,user:user,token:token}):/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});case'signin':return/*#__PURE__*/_jsx(SignIn,{onLogin:doLogin,onSwitch:()=>setCurrentView('signup')});case'signup':return/*#__PURE__*/_jsx(SignUp,{onSignup:doSignup,onSwitch:()=>setCurrentView('signin')});case'chat':return/*#__PURE__*/_jsx(Chat,{user:user,token:token,conversationId:conversationId,onSelectConversation:id=>{setConversationId(id);setCurrentView('chat');},onLeave:()=>{setConversationId(null);setCurrentView('chat');}});case'exchanges':return/*#__PURE__*/_jsx(Exchanges,{user:user,token:token,exchanges:exchanges,refresh:fetchExchanges,onOpenConversation:id=>{setConversationId(id);setCurrentView('chat');}});case'profile':return/*#__PURE__*/_jsx(Profile,{user:user,onUpdate:u=>{setUser(u);localStorage.setItem('be_user',JSON.stringify(u));},token:token});default:return/*#__PURE__*/_jsx(Hero,{setView:setCurrentView,handleLogin:handleLogin,user:user});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen pb-10 fancy-app\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-blob\"}),/*#__PURE__*/_jsx(Navbar,{user:user,setView:setCurrentView,currentView:currentView,handleLogin:handleLogin,handleLogout:handleLogout}),notification&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed top-20 right-4 z-50 px-6 py-3 rounded-lg shadow-xl border animate-fade-in-down \".concat(notification.type==='success'?'bg-emerald-100 border-emerald-200 text-emerald-800':notification.type==='error'?'bg-red-100 border-red-200 text-red-800':'bg-gray-800 text-white'),children:notification.message}),/*#__PURE__*/_jsx(\"main\",{children:renderView()})]});}// --- Auth / Chat / Profile UI Components ---\nfunction SignIn(_ref6){let{onLogin,onSwitch}=_ref6;const[email,setEmail]=useState('');const[password,setPassword]=useState('');return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Sign In\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",placeholder:\"Email\",value:email,onChange:e=>setEmail(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"w-full mb-4 p-2 border rounded\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onLogin(email,password),className:\"bg-emerald-600 text-white px-4 py-2 rounded\",children:\"Sign In\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onSwitch,className:\"px-4 py-2 border rounded\",children:\"Create Account\"})]})]})});}function SignUp(_ref7){let{onSignup,onSwitch}=_ref7;const[name,setName]=useState('');const[email,setEmail]=useState('');const[password,setPassword]=useState('');return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Create Account\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",placeholder:\"Name\",value:name,onChange:e=>setName(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",placeholder:\"Email\",value:email,onChange:e=>setEmail(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"w-full mb-4 p-2 border rounded\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onSignup(name,email,password),className:\"bg-emerald-600 text-white px-4 py-2 rounded\",children:\"Sign Up\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onSwitch,className:\"px-4 py-2 border rounded\",children:\"Sign In\"})]})]})});}import{io as ioClient}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Chat(_ref8){let{user,token,conversationId,onSelectConversation,onLeave}=_ref8;const[messages,setMessages]=useState([]);const[text,setText]=useState('');const[conversations,setConversations]=useState([]);const socketRef=React.useRef(null);useEffect(()=>{let mounted=true;async function load(){if(conversationId){const res=await fetch(\"/api/conversations/\".concat(conversationId,\"/messages\"),{headers:{Authorization:token?\"Bearer \".concat(token):''}});const data=await res.json();if(mounted)setMessages(data||[]);return;}const res=await fetch('/api/messages');const data=await res.json();if(mounted)setMessages(data||[]);}async function loadConvs(){if(!token)return;const r=await fetch('/api/conversations',{headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();setConversations(d||[]);}load();loadConvs();// connect socket\nsocketRef.current=ioClient(window.location.origin.replace(/:\\d+$/,'')+':5000');// identify the socket with token so server can join user-specific room\nif(token){socketRef.current.emit('identify',token);}socketRef.current.on('message',msg=>{if(!conversationId)setMessages(prev=>[...prev,msg]);});socketRef.current.on('conversationMessage',msg=>{// only append if it belongs to our open conversation\nif(conversationId&&msg.conversationId===conversationId)setMessages(prev=>[...prev,msg]);// if not open, update conversation list (unread handled server-side)\nif(!conversationId)loadConvs();});// exchange notifications\nsocketRef.current.on('exchangeRequest',ex=>{showNotification('New exchange request','default');fetchExchanges();loadConvs();});socketRef.current.on('exchangeAccepted',ex=>{showNotification('An exchange was accepted','success');fetchExchanges();fetchBooks();});socketRef.current.on('exchangeDeclined',ex=>{showNotification('An exchange was declined','error');fetchExchanges();});return()=>{mounted=false;if(socketRef.current)socketRef.current.disconnect();};},[conversationId,token]);useEffect(()=>{// when conversationId changes, join/leave socket room\nif(!socketRef.current)return;if(conversationId){socketRef.current.emit('joinConversation',conversationId);// mark read on server\nif(token)fetch(\"/api/conversations/\".concat(conversationId,\"/read\"),{method:'PUT',headers:{Authorization:\"Bearer \".concat(token)}}).catch(()=>{});}return()=>{if(conversationId)socketRef.current.emit('leaveConversation',conversationId);};},[conversationId]);const send=async()=>{if(!text.trim())return;try{if(conversationId){// send via socket to conversation room\nif(socketRef.current&&socketRef.current.connected){socketRef.current.emit('sendConversationMessage',{token,text,conversationId});}else{await fetch(\"/api/conversations/\".concat(conversationId,\"/messages\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:token?\"Bearer \".concat(token):''},body:JSON.stringify({text})});}}else{// public send\nif(socketRef.current)socketRef.current.emit('sendMessage',{token,text});else await fetch('/api/messages',{method:'POST',headers:{'Content-Type':'application/json',Authorization:token?\"Bearer \".concat(token):''},body:JSON.stringify({text})});}setText('');}catch(e){console.error(e);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold\",children:\"Chat\"}),conversationId?/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(onLeave)onLeave();},className:\"text-sm text-gray-600\",children:\"Leave\"}):null]}),!conversationId&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2\",children:\"Your Conversations\"}),conversations.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"No conversations yet. Request a book to start a private chat.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:conversations.map(c=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onSelectConversation&&onSelectConversation(c.id),className:\"w-full text-left p-3 border rounded hover:bg-gray-50 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-left\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium\",children:[\"Conversation about \",c.bookId?\"book:\".concat(c.bookId):'general']}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"With: \",(c.participantsInfo||c.participants).map(p=>p.name||p).filter(Boolean).join(', ')]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[c.unreadCount?/*#__PURE__*/_jsx(\"div\",{className:\"bg-emerald-600 text-white text-xs px-2 py-1 rounded-full\",children:c.unreadCount}):null,/*#__PURE__*/_jsx(ArrowRight,{className:\"w-4 h-4 text-gray-400\"})]})]},c.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-glass p-4 rounded shadow h-[55vh] flex flex-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-auto mb-4\",children:messages.map(m=>/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[m.fromName||m.from,\" \\u2022 \",new Date(m.createdAt).toLocaleTimeString()]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-100 inline-block p-2 rounded mt-1\",children:m.text})]},m.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{value:text,onChange:e=>setText(e.target.value),className:\"flex-1 p-2 border rounded\",placeholder:user?conversationId?'Message the other participant...':'Write a public message...':'Sign in to chat',disabled:!user}),/*#__PURE__*/_jsx(\"button\",{onClick:send,className:\"bg-emerald-600 text-white px-4 py-2 rounded\",disabled:!user,children:\"Send\"})]})]})]});}function Profile(_ref9){let{user,onUpdate,token}=_ref9;const[name,setName]=useState((user===null||user===void 0?void 0:user.name)||'');const[bio,setBio]=useState((user===null||user===void 0?void 0:user.bio)||'');const save=async()=>{try{if(!token)return;const res=await fetch(\"/api/users/\".concat(user.id),{method:'PUT',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)},body:JSON.stringify({name,bio})});const data=await res.json();if(res.ok){onUpdate(data);showNotification('Profile updated','success');}else{showNotification(data.error||'Failed to update profile','error');}}catch(e){console.error(e);showNotification('Failed to update profile','error');}};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md mx-auto px-4 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Profile\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full mb-2 p-2 border rounded\",value:name,onChange:e=>setName(e.target.value)}),/*#__PURE__*/_jsx(\"textarea\",{className:\"w-full mb-2 p-2 border rounded\",value:bio,onChange:e=>setBio(e.target.value)}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:/*#__PURE__*/_jsx(\"button\",{onClick:save,className:\"bg-emerald-600 text-white px-4 py-2 rounded\",children:\"Save\"})})]})});}function Exchanges(_ref0){let{user,token,exchanges,refresh,onOpenConversation}=_ref0;const accept=async id=>{if(!token)return;try{const r=await fetch(\"/api/exchanges/\".concat(id,\"/accept\"),{method:'PUT',headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();if(r.ok){refresh();alert('Exchange accepted');}else alert(d.error||'Failed');}catch(e){console.error(e);alert('Failed');}};const decline=async id=>{if(!token)return;try{const r=await fetch(\"/api/exchanges/\".concat(id,\"/decline\"),{method:'PUT',headers:{Authorization:\"Bearer \".concat(token)}});const d=await r.json();if(r.ok){refresh();alert('Exchange declined');}else alert(d.error||'Failed');}catch(e){console.error(e);alert('Failed');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Exchange Requests\"}),exchanges.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"No exchange activity.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:exchanges.map(e=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border p-4 rounded flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"Book: \",e.bookId]}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[\"From: \",e.requesterId,\" \\u2014 Status: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:e.status})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 mt-2\",children:e.message}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400 mt-2\",children:[\"Requested at: \",new Date(e.createdAt).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-2\",children:[e.ownerId===(user===null||user===void 0?void 0:user.id)&&e.status==='requested'?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>accept(e.id),className:\"px-3 py-2 bg-emerald-600 text-white rounded\",children:\"Accept\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>decline(e.id),className:\"px-3 py-2 border rounded\",children:\"Decline\"})]}):null,/*#__PURE__*/_jsx(\"button\",{onClick:()=>{var _e$conversation;return onOpenConversation&&onOpenConversation(e.conversationId||((_e$conversation=e.conversation)===null||_e$conversation===void 0?void 0:_e$conversation.id));},className:\"px-3 py-2 bg-gray-100 rounded\",children:\"Open Chat\"})]})]},e.id))})]});}","map":{"version":3,"names":["React","useState","useEffect","Book","Search","PlusCircle","Library","User","LogOut","RefreshCw","MapPin","Heart","MessageSquare","ArrowRight","API_BASE","BOOKS_API","concat","Navbar","_ref","user","setView","currentView","handleLogin","handleLogout","_jsx","className","children","_jsxs","onClick","_Fragment","id","slice","toUpperCase","title","Hero","_ref2","BookCard","_ref3","book","handleExchange","handleChat","imageUrl","src","alt","onError","e","target","condition","genre","author","location","ownerId","status","disabled","Browse","_ref4","books","loading","searchTerm","setSearchTerm","filteredBooks","filter","toLowerCase","includes","type","placeholder","value","onChange","length","map","AddBook","_ref5","token","setLoading","formData","setFormData","handleSubmit","preventDefault","fetch","method","headers","Authorization","body","JSON","stringify","_objectSpread","error","console","alert","onSubmit","required","App","setUser","setBooks","setCurrentView","notification","setNotification","setToken","conversationId","setConversationId","exchanges","setExchanges","unreadTotal","setUnreadTotal","apiFetch","url","opts","arguments","undefined","t","localStorage","getItem","u","parse","then","r","json","data","setItem","removeItem","catch","fetchBooks","res","err","fetchExchanges","compute","d","total","reduce","s","c","unreadCount","badge","document","getElementById","textContent","classList","remove","add","doSignup","name","email","password","showNotification","doLogin","confirm","_data$conversation","bookId","message","ok","Error","conv","conversation","otherUserId","setTimeout","renderView","SignIn","onLogin","onSwitch","SignUp","onSignup","Chat","onSelectConversation","onLeave","Exchanges","refresh","onOpenConversation","Profile","onUpdate","_ref6","setEmail","setPassword","_ref7","setName","io","ioClient","jsx","jsxs","Fragment","_ref8","messages","setMessages","text","setText","conversations","setConversations","socketRef","useRef","mounted","load","loadConvs","current","window","origin","replace","emit","on","msg","prev","ex","disconnect","send","trim","connected","participantsInfo","participants","p","Boolean","join","m","fromName","from","Date","createdAt","toLocaleTimeString","_ref9","bio","setBio","save","_ref0","accept","decline","requesterId","toLocaleString","_e$conversation"],"sources":["C:/Users/dell/Desktop/pro/book-exchange-app/client/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Book, \r\n  Search, \r\n  PlusCircle, \r\n  Library, \r\n  User, \r\n  LogOut, \r\n  RefreshCw, \r\n  MapPin,\r\n  Heart,\r\n  MessageSquare,\r\n  ArrowRight\r\n} from 'lucide-react';\r\n\r\n// Use the server API (file-based) instead of Firebase.\r\nconst API_BASE = '';\r\nconst BOOKS_API = `${API_BASE}/api/books`;\r\n\r\n// --- Components ---\r\n\r\nconst Navbar = ({ user, setView, currentView, handleLogin, handleLogout }) => (\r\n  <nav className=\"site-header sticky top-0 z-50 px-4 py-3\">\r\n    <div className=\"max-w-6xl mx-auto flex justify-between items-center\">\r\n      <div \r\n        className=\"flex items-center gap-2 cursor-pointer site-logo\" \r\n        onClick={() => setView('home')}\r\n      >\r\n        <div className=\"logo-badge\">\r\n          <Book className=\"w-6 h-6 text-white\" />\r\n        </div>\r\n        <span className=\"logo-text\">BookLoop</span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-6\">\r\n        <button \r\n          onClick={() => setView('browse')}\r\n          className={`text-sm font-medium transition ${currentView === 'browse' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n        >\r\n          Browse Books\r\n        </button>\r\n        <button \r\n          onClick={() => setView('chat')}\r\n          className={`text-sm font-medium transition ${currentView === 'chat' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n        >\r\n          Chat\r\n        </button>\r\n        <button onClick={() => setView('exchanges')} className={`text-sm font-medium transition ${currentView === 'exchanges' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}>Requests</button>\r\n        \r\n        {user ? (\r\n          <>\r\n            <button \r\n              onClick={() => setView('add')}\r\n              className={`text-sm font-medium transition flex items-center gap-1 ${currentView === 'add' ? 'text-emerald-600' : 'text-gray-500 hover:text-gray-800'}`}\r\n            >\r\n              <PlusCircle className=\"w-4 h-4\" />\r\n              Add Book\r\n            </button>\r\n            <div className=\"flex items-center gap-3 pl-4 border-l\">\r\n              <div className=\"relative\">\r\n                <div className=\"w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-bold text-xs\">\r\n                  {(user?.id || '').slice(0,2).toUpperCase()}\r\n                </div>\r\n                {/* badge for unread */}\r\n                <div id=\"nav-unread-badge\" className=\"absolute -top-2 -right-2 bg-rose-500 text-white text-[10px] px-1 rounded-full hidden\">0</div>\r\n              </div>\r\n              <button \r\n                onClick={handleLogout}\r\n                className=\"text-gray-400 hover:text-red-500 transition\"\r\n                title=\"Logout\"\r\n              >\r\n                <LogOut className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <div className=\"flex items-center gap-3\">\r\n            <button onClick={() => setView('signin')} className=\"text-sm text-gray-700 hover:text-gray-900\">Sign In</button>\r\n            <button onClick={() => setView('signup')} className=\"bg-emerald-600 text-white px-3 py-1 rounded-md text-sm\">Sign Up</button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  </nav>\r\n);\r\n\r\nconst Hero = ({ setView, handleLogin, user }) => (\r\n  <div className=\"bg-gradient-to-b from-emerald-50 to-white pt-20 pb-24 px-4\">\r\n    <div className=\"max-w-4xl mx-auto text-center\">\r\n      <div className=\"inline-flex items-center gap-2 bg-white/6 text-emerald-300 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-6 backdrop-blur\">\r\n        <RefreshCw className=\"w-3 h-3\" />\r\n        The #1 Book Exchange Platform\r\n      </div>\r\n      <h1 className=\"text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 leading-tight\">\r\n        Give a Book. <br/>\r\n        <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500\">\r\n          Get a Book.\r\n        </span>\r\n      </h1>\r\n      <p className=\"text-xl text-gray-600 mb-10 max-w-2xl mx-auto leading-relaxed\">\r\n        Join a community of readers. Upload the books gathering dust on your shelf and swap them for your next great adventure.\r\n      </p>\r\n      <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\r\n        <button \r\n          onClick={() => setView('browse')}\r\n          className=\"neon-btn w-full sm:w-auto\"\r\n        >\r\n          Start Browsing\r\n        </button>\r\n        {!user && (\r\n          <button \r\n            onClick={handleLogin}\r\n            className=\"outline-btn w-full sm:w-auto px-8 py-4 font-bold text-lg transition\"\r\n          >\r\n            Join Now\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Stats */}\r\n      <div className=\"mt-16 grid grid-cols-3 gap-8 max-w-2xl mx-auto border-t pt-8\">\r\n        <div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">2k+</div>\r\n          <div className=\"text-sm text-gray-500 mt-1\">Active Readers</div>\r\n        </div>\r\n        <div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">5k+</div>\r\n          <div className=\"text-sm text-gray-500 mt-1\">Books Swapped</div>\r\n        </div>\r\n        <div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">100%</div>\r\n          <div className=\"text-sm text-gray-500 mt-1\">Free to Join</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst BookCard = ({ book, user, handleExchange, handleChat }) => {\r\n  return (\r\n    <div className=\"group fancy-card animate-tilt flex flex-col overflow-hidden h-full\">\r\n      <div className=\"h-48 overflow-hidden relative bg-gray-100\">\r\n        {book.imageUrl ? (\r\n          <img \r\n            src={book.imageUrl} \r\n            alt={book.title} \r\n            className=\"w-full h-full object-cover transition duration-500 group-hover:scale-105\"\r\n            onError={(e) => {\r\n              e.target.src = 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?auto=format&fit=crop&q=80&w=2730';\r\n            }}\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center text-gray-300 bg-slate-50\">\r\n            <Book className=\"w-16 h-16\" />\r\n          </div>\r\n        )}\r\n        <div className=\"absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-bold text-gray-700 shadow-sm\">\r\n          {book.condition}\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"p-5 flex flex-col flex-grow\">\r\n        <div className=\"text-xs font-semibold text-emerald-600 mb-2 uppercase tracking-wider\">{book.genre || 'General'}</div>\r\n        <h3 className=\"text-lg font-bold text-gray-900 mb-1 leading-tight\">{book.title}</h3>\r\n        <p className=\"text-sm text-gray-500 mb-4\">by {book.author}</p>\r\n        \r\n        <div className=\"flex items-center gap-2 text-xs text-gray-400 mb-6 mt-auto\">\r\n          <MapPin className=\"w-3 h-3\" />\r\n          <span>{book.location || 'Remote'}</span>\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-between pt-4 border-t border-gray-50 mt-auto\">\r\n           <div className=\"flex items-center gap-2\">\r\n             <div className=\"w-6 h-6 rounded-full bg-gradient-to-br from-purple-400 to-indigo-500 text-[10px] text-white flex items-center justify-center\">\r\n               {book.ownerId ? book.ownerId.slice(0,2).toUpperCase() : '??'}\r\n             </div>\r\n             <span className=\"text-xs text-gray-500\">Owner</span>\r\n           </div>\r\n\r\n           {user && user.id === book.ownerId ? (\r\n             <span className=\"text-xs font-medium text-gray-400 bg-gray-100 px-3 py-1 rounded-full\">Your Book</span>\r\n           ) : (\r\n             <div className=\"flex items-center gap-2\">\r\n              {book.status && book.status !== 'available' ? (\r\n                   <span className=\"glow-badge\">{book.status}</span>\r\n                 ) : (\r\n                   <button \r\n                    onClick={() => handleExchange(book)}\r\n                    disabled={book.status === 'exchanged'}\r\n                    className={`neon-btn ${book.status === 'exchanged' ? 'opacity-60 cursor-not-allowed' : ''}`}\r\n                   >\r\n                     {book.status === 'exchanged' ? 'Taken' : 'Request'}\r\n                   </button>\r\n                 )}\r\n               <button onClick={() => handleChat && handleChat(book)} className=\"text-sm px-3 py-2 border rounded-lg bg-white hover:bg-gray-50 flex items-center gap-2\">\r\n                 <MessageSquare className=\"w-4 h-4\" />\r\n                 <span>Message</span>\r\n               </button>\r\n             </div>\r\n           )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Browse = ({ books, loading, user, handleExchange, handleChat }) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  \r\n  const filteredBooks = books.filter(book => \r\n    book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    book.author.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-4 py-8\">\r\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-gray-900\">Explore Collection</h2>\r\n          <p className=\"text-gray-500\">Find your next favorite read.</p>\r\n        </div>\r\n        \r\n        <div className=\"relative w-full md:w-96\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n          <input \r\n            type=\"text\" \r\n            placeholder=\"Search by title or author...\" \r\n            className=\"w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 outline-none transition\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600\"></div>\r\n        </div>\r\n      ) : filteredBooks.length === 0 ? (\r\n        <div className=\"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200\">\r\n          <Book className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900\">No books found</h3>\r\n          <p className=\"text-gray-500\">Try adjusting your search terms.</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n          {filteredBooks.map(book => (\r\n            <BookCard key={book.id} book={book} user={user} handleExchange={handleExchange} handleChat={handleChat} />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AddBook = ({ setView, user, token }) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    author: '',\r\n    genre: 'Fiction',\r\n    condition: 'Good',\r\n    location: '',\r\n    imageUrl: ''\r\n  });\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!user) return;\r\n    setLoading(true);\r\n\r\n    try {\r\n      // Post to server\r\n      await fetch(BOOKS_API, { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: token ? `Bearer ${token}` : '' }, body: JSON.stringify({ ...formData, ownerId: user.id }) });\r\n      setView('browse');\r\n    } catch (error) {\r\n      console.error(\"Error adding book:\", error);\r\n      alert(\"Failed to add book. Try again.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded-2xl shadow-lg border border-gray-100\">\r\n        <div className=\"flex items-center gap-3 mb-8\">\r\n          <div className=\"bg-emerald-100 p-3 rounded-full\">\r\n            <PlusCircle className=\"w-6 h-6 text-emerald-600\" />\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold text-gray-900\">List a Book</h2>\r\n            <p className=\"text-gray-500 text-sm\">Share a book with the community</p>\r\n          </div>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Book Title</label>\r\n              <input \r\n                required\r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n                placeholder=\"e.g. The Great Gatsby\"\r\n                value={formData.title}\r\n                onChange={e => setFormData({...formData, title: e.target.value})}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Author</label>\r\n              <input \r\n                required\r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n                placeholder=\"e.g. F. Scott Fitzgerald\"\r\n                value={formData.author}\r\n                onChange={e => setFormData({...formData, author: e.target.value})}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Genre</label>\r\n              <select \r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\"\r\n                value={formData.genre}\r\n                onChange={e => setFormData({...formData, genre: e.target.value})}\r\n              >\r\n                <option>Fiction</option>\r\n                <option>Non-Fiction</option>\r\n                <option>Sci-Fi</option>\r\n                <option>Mystery</option>\r\n                <option>Biography</option>\r\n                <option>Textbook</option>\r\n              </select>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <label className=\"text-sm font-semibold text-gray-700\">Condition</label>\r\n              <select \r\n                className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition bg-white\"\r\n                value={formData.condition}\r\n                onChange={e => setFormData({...formData, condition: e.target.value})}\r\n              >\r\n                <option>New</option>\r\n                <option>Like New</option>\r\n                <option>Good</option>\r\n                <option>Fair</option>\r\n                <option>Poor</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-semibold text-gray-700\">Cover Image URL</label>\r\n            <input \r\n              type=\"url\"\r\n              className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n              placeholder=\"https://example.com/image.jpg\"\r\n              value={formData.imageUrl}\r\n              onChange={e => setFormData({...formData, imageUrl: e.target.value})}\r\n            />\r\n            <p className=\"text-xs text-gray-500\">Tip: Search Google Images, right click image, \"Copy Image Address\"</p>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-semibold text-gray-700\">City/Location</label>\r\n            <input \r\n              required\r\n              className=\"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emerald-100 focus:border-emerald-500 outline-none transition\"\r\n              placeholder=\"e.g. New York, NY\"\r\n              value={formData.location}\r\n              onChange={e => setFormData({...formData, location: e.target.value})}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"pt-4 flex gap-4\">\r\n            <button \r\n              type=\"button\"\r\n              onClick={() => setView('browse')}\r\n              className=\"flex-1 px-6 py-3 border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button \r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"flex-1 px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl shadow-lg shadow-emerald-200 transition flex justify-center items-center\"\r\n            >\r\n              {loading ? <span className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></span> : 'List Book'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- Main App Component ---\r\n\r\nexport default function App() {\r\n  const [user, setUser] = useState(null);\r\n  const [books, setBooks] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [currentView, setCurrentView] = useState('home'); // home, browse, add\r\n  const [notification, setNotification] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [conversationId, setConversationId] = useState(null);\r\n  const [exchanges, setExchanges] = useState([]);\r\n  const [unreadTotal, setUnreadTotal] = useState(0);\r\n\r\n  const apiFetch = (url, opts = {}) => {\r\n    const headers = opts.headers || {};\r\n    if (token) headers['Authorization'] = `Bearer ${token}`;\r\n    return fetch(url, { ...opts, headers });\r\n  };\r\n\r\n  // 1. Auth Handling (JWT stored in localStorage)\r\n  useEffect(() => {\r\n    const t = localStorage.getItem('be_token');\r\n    const u = localStorage.getItem('be_user');\r\n    if (t) setToken(t);\r\n    if (u) setUser(JSON.parse(u));\r\n    // verify token and refresh user\r\n    if (t) {\r\n      fetch('/api/me', { headers: { Authorization: `Bearer ${t}` } })\r\n        .then(r => r.json())\r\n        .then(data => { if (!data.error) { setUser(data); localStorage.setItem('be_user', JSON.stringify(data)); } else { localStorage.removeItem('be_token'); localStorage.removeItem('be_user'); setToken(null); setUser(null); } })\r\n        .catch(() => {});\r\n    }\r\n  }, []);\r\n\r\n  // 2. Data Fetching\r\n  const fetchBooks = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(BOOKS_API);\r\n      const data = await res.json();\r\n      setBooks(data || []);\r\n    } catch (err) {\r\n      console.error('Fetch books error', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchExchanges = async () => {\r\n    if (!token) return setExchanges([]);\r\n    try {\r\n      const res = await apiFetch('/api/exchanges');\r\n      const data = await res.json();\r\n      setExchanges(data || []);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  useEffect(() => { fetchBooks(); }, []);\r\n  useEffect(() => { fetchExchanges(); }, [token]);\r\n  useEffect(() => {\r\n    // compute unread total from conversations\r\n    async function compute() {\r\n      if (!token) return setUnreadTotal(0);\r\n      try {\r\n        const r = await fetch('/api/conversations', { headers: { Authorization: `Bearer ${token}` } });\r\n        const d = await r.json();\r\n        const total = (d || []).reduce((s, c) => s + (c.unreadCount || 0), 0);\r\n        setUnreadTotal(total);\r\n        // update navbar badge\r\n        const badge = document.getElementById('nav-unread-badge');\r\n        if (badge) {\r\n          if (total > 0) { badge.textContent = total; badge.classList.remove('hidden'); }\r\n          else { badge.classList.add('hidden'); }\r\n        }\r\n      } catch (e) { console.error(e); }\r\n    }\r\n    compute();\r\n  }, [token, conversationId]);\r\n\r\n  // Actions\r\n  const handleLogin = () => setCurrentView('signin');\r\n\r\n  const doSignup = async (name, email, password) => {\r\n    try {\r\n      const res = await fetch('/api/signup', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, email, password }) });\r\n      const data = await res.json();\r\n      if (data.token) {\r\n        localStorage.setItem('be_token', data.token);\r\n        localStorage.setItem('be_user', JSON.stringify(data.user));\r\n        setToken(data.token);\r\n        setUser(data.user);\r\n        setCurrentView('browse');\r\n        showNotification('Account created', 'success');\r\n      } else {\r\n        showNotification(data.error || 'Signup failed', 'error');\r\n      }\r\n    } catch (err) { showNotification('Signup failed', 'error'); }\r\n  };\r\n\r\n  const doLogin = async (email, password) => {\r\n    try {\r\n      const res = await fetch('/api/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });\r\n      const data = await res.json();\r\n      if (data.token) {\r\n        localStorage.setItem('be_token', data.token);\r\n        localStorage.setItem('be_user', JSON.stringify(data.user));\r\n        setToken(data.token);\r\n        setUser(data.user);\r\n        setCurrentView('browse');\r\n        showNotification('Signed in', 'success');\r\n      } else {\r\n        showNotification(data.error || 'Login failed', 'error');\r\n      }\r\n    } catch (err) { showNotification('Login failed', 'error'); }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('be_user');\r\n    localStorage.removeItem('be_token');\r\n    setUser(null);\r\n    setToken(null);\r\n    setCurrentView('home');\r\n    showNotification('Logged out', 'default');\r\n  };\r\n\r\n  const handleExchange = async (book) => {\r\n    if (!user) { showNotification('Please sign in to request books.', 'error'); return; }\r\n    if (!confirm(`Request to exchange \"${book.title}\"?`)) return;\r\n    try {\r\n      // create an exchange request (server will create/get conversation)\r\n      const res = await apiFetch('/api/exchanges', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ bookId: book.id, message: `I'd like to request ${book.title}` }) });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || 'Failed to create exchange');\r\n      const conv = data.conversation || data.conversationId || data.conversation?.id || (data.conversation && data.conversation.id ? data.conversation : null);\r\n      if (conv && conv.id) {\r\n        setConversationId(conv.id);\r\n        setCurrentView('chat');\r\n      } else if (data.conversation && data.conversation.id) {\r\n        setConversationId(data.conversation.id);\r\n        setCurrentView('chat');\r\n      }\r\n      showNotification('Request sent and private chat opened.', 'success');\r\n      fetchBooks();\r\n      fetchExchanges();\r\n    } catch (err) {\r\n      console.error(err);\r\n      showNotification('Failed to process exchange.', 'error');\r\n    }\r\n  };\r\n\r\n  const handleChat = async (book) => {\r\n    if (!user) { showNotification('Please sign in to chat with owners.', 'error'); setCurrentView('signin'); return; }\r\n    try {\r\n      const res = await apiFetch('/api/conversations', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ otherUserId: book.ownerId, bookId: book.id }) });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || 'Failed to create conversation');\r\n      const conv = data || null;\r\n      if (conv && conv.id) {\r\n        setConversationId(conv.id);\r\n        setCurrentView('chat');\r\n      }\r\n      showNotification('Private chat opened with owner.', 'success');\r\n    } catch (err) {\r\n      console.error(err);\r\n      showNotification('Failed to open chat.', 'error');\r\n    }\r\n  };\r\n\r\n  const showNotification = (message, type = 'default') => {\r\n    setNotification({ message, type });\r\n    setTimeout(() => setNotification(null), 3000);\r\n  };\r\n\r\n  // Helper for View Rendering\r\n  const renderView = () => {\r\n    switch (currentView) {\r\n      case 'home':\r\n        return <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n      case 'browse':\r\n        return <Browse books={books} loading={loading} user={user} handleExchange={handleExchange} handleChat={handleChat} />;\r\n      case 'add':\r\n        return user ? <AddBook setView={setCurrentView} user={user} token={token} /> : <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n      case 'signin':\r\n        return <SignIn onLogin={doLogin} onSwitch={() => setCurrentView('signup')} />;\r\n      case 'signup':\r\n        return <SignUp onSignup={doSignup} onSwitch={() => setCurrentView('signin')} />;\r\n      case 'chat':\r\n        return <Chat user={user} token={token} conversationId={conversationId} onSelectConversation={id => { setConversationId(id); setCurrentView('chat'); }} onLeave={() => { setConversationId(null); setCurrentView('chat'); }} />;\r\n      case 'exchanges':\r\n        return <Exchanges user={user} token={token} exchanges={exchanges} refresh={fetchExchanges} onOpenConversation={(id)=>{ setConversationId(id); setCurrentView('chat'); }} />;\r\n      case 'profile':\r\n        return <Profile user={user} onUpdate={(u)=>{ setUser(u); localStorage.setItem('be_user', JSON.stringify(u)); }} token={token} />;\r\n      default:\r\n        return <Hero setView={setCurrentView} handleLogin={handleLogin} user={user} />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen pb-10 fancy-app\">\r\n      <div className=\"bg-blob\"></div>\r\n      <Navbar \r\n        user={user} \r\n        setView={setCurrentView} \r\n        currentView={currentView}\r\n        handleLogin={handleLogin}\r\n        handleLogout={handleLogout}\r\n      />\r\n      \r\n      {/* Notification Toast */}\r\n      {notification && (\r\n        <div className={`fixed top-20 right-4 z-50 px-6 py-3 rounded-lg shadow-xl border animate-fade-in-down ${\r\n          notification.type === 'success' ? 'bg-emerald-100 border-emerald-200 text-emerald-800' :\r\n          notification.type === 'error' ? 'bg-red-100 border-red-200 text-red-800' :\r\n          'bg-gray-800 text-white'\r\n        }`}>\r\n          {notification.message}\r\n        </div>\r\n      )}\r\n\r\n      <main>\r\n        {renderView()}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\n// --- Auth / Chat / Profile UI Components ---\r\n\r\nfunction SignIn({ onLogin, onSwitch }) {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  return (\r\n    <div className=\"max-w-md mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded shadow\">\r\n        <h2 className=\"text-xl font-bold mb-4\">Sign In</h2>\r\n        <input className=\"w-full mb-2 p-2 border rounded\" placeholder=\"Email\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n        <input type=\"password\" className=\"w-full mb-4 p-2 border rounded\" placeholder=\"Password\" value={password} onChange={e=>setPassword(e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={()=>onLogin(email,password)} className=\"bg-emerald-600 text-white px-4 py-2 rounded\">Sign In</button>\r\n          <button onClick={onSwitch} className=\"px-4 py-2 border rounded\">Create Account</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SignUp({ onSignup, onSwitch }) {\r\n  const [name, setName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  return (\r\n    <div className=\"max-w-md mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded shadow\">\r\n        <h2 className=\"text-xl font-bold mb-4\">Create Account</h2>\r\n        <input className=\"w-full mb-2 p-2 border rounded\" placeholder=\"Name\" value={name} onChange={e=>setName(e.target.value)} />\r\n        <input className=\"w-full mb-2 p-2 border rounded\" placeholder=\"Email\" value={email} onChange={e=>setEmail(e.target.value)} />\r\n        <input type=\"password\" className=\"w-full mb-4 p-2 border rounded\" placeholder=\"Password\" value={password} onChange={e=>setPassword(e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={()=>onSignup(name,email,password)} className=\"bg-emerald-600 text-white px-4 py-2 rounded\">Sign Up</button>\r\n          <button onClick={onSwitch} className=\"px-4 py-2 border rounded\">Sign In</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nimport { io as ioClient } from 'socket.io-client';\r\n\r\nfunction Chat({ user, token, conversationId, onSelectConversation, onLeave }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [text, setText] = useState('');\r\n  const [conversations, setConversations] = useState([]);\r\n  const socketRef = React.useRef(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load(){\r\n      if (conversationId) {\r\n        const res = await fetch(`/api/conversations/${conversationId}/messages`, { headers: { Authorization: token ? `Bearer ${token}` : '' } });\r\n        const data = await res.json();\r\n        if(mounted) setMessages(data || []);\r\n        return;\r\n      }\r\n      const res = await fetch('/api/messages');\r\n      const data = await res.json();\r\n      if(mounted) setMessages(data || []);\r\n    }\r\n    async function loadConvs(){\r\n      if (!token) return;\r\n      const r = await fetch('/api/conversations', { headers: { Authorization: `Bearer ${token}` } });\r\n      const d = await r.json();\r\n      setConversations(d || []);\r\n    }\r\n    load();\r\n    loadConvs();\r\n\r\n    // connect socket\r\n    socketRef.current = ioClient(window.location.origin.replace(/:\\d+$/,'') + ':5000');\r\n    // identify the socket with token so server can join user-specific room\r\n    if (token) {\r\n      socketRef.current.emit('identify', token);\r\n    }\r\n    socketRef.current.on('message', (msg) => {\r\n      if (!conversationId) setMessages(prev => [...prev, msg]);\r\n    });\r\n    socketRef.current.on('conversationMessage', (msg) => {\r\n      // only append if it belongs to our open conversation\r\n      if (conversationId && msg.conversationId === conversationId) setMessages(prev => [...prev, msg]);\r\n      // if not open, update conversation list (unread handled server-side)\r\n      if (!conversationId) loadConvs();\r\n    });\r\n    // exchange notifications\r\n    socketRef.current.on('exchangeRequest', (ex) => {\r\n      showNotification('New exchange request', 'default');\r\n      fetchExchanges();\r\n      loadConvs();\r\n    });\r\n    socketRef.current.on('exchangeAccepted', (ex) => {\r\n      showNotification('An exchange was accepted', 'success');\r\n      fetchExchanges();\r\n      fetchBooks();\r\n    });\r\n    socketRef.current.on('exchangeDeclined', (ex) => {\r\n      showNotification('An exchange was declined', 'error');\r\n      fetchExchanges();\r\n    });\r\n\r\n    return ()=>{ mounted=false; if(socketRef.current) socketRef.current.disconnect(); };\r\n  }, [conversationId, token]);\r\n\r\n  useEffect(() => {\r\n    // when conversationId changes, join/leave socket room\r\n    if (!socketRef.current) return;\r\n    if (conversationId) {\r\n      socketRef.current.emit('joinConversation', conversationId);\r\n      // mark read on server\r\n      if (token) fetch(`/api/conversations/${conversationId}/read`, { method: 'PUT', headers: { Authorization: `Bearer ${token}` } }).catch(()=>{});\r\n    }\r\n    return () => {\r\n      if (conversationId) socketRef.current.emit('leaveConversation', conversationId);\r\n    };\r\n  }, [conversationId]);\r\n\r\n  const send = async () => {\r\n    if (!text.trim()) return;\r\n    try {\r\n      if (conversationId) {\r\n        // send via socket to conversation room\r\n        if (socketRef.current && socketRef.current.connected) {\r\n          socketRef.current.emit('sendConversationMessage', { token, text, conversationId });\r\n        } else {\r\n          await fetch(`/api/conversations/${conversationId}/messages`, { method: 'POST', headers: { 'Content-Type':'application/json', Authorization: token ? `Bearer ${token}` : '' }, body: JSON.stringify({ text }) });\r\n        }\r\n      } else {\r\n        // public send\r\n        if (socketRef.current) socketRef.current.emit('sendMessage', { token, text });\r\n        else await fetch('/api/messages', { method: 'POST', headers: { 'Content-Type':'application/json', Authorization: token ? `Bearer ${token}` : '' }, body: JSON.stringify({ text }) });\r\n      }\r\n      setText('');\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto px-4 py-8\">\r\n      <div className=\"mb-4 flex items-center justify-between\">\r\n        <h2 className=\"text-xl font-bold\">Chat</h2>\r\n        {conversationId ? <button onClick={() => { if (onLeave) onLeave(); }} className=\"text-sm text-gray-600\">Leave</button> : null}\r\n      </div>\r\n\r\n      {!conversationId && (\r\n        <div className=\"mb-4\">\r\n          <h3 className=\"font-semibold mb-2\">Your Conversations</h3>\r\n          {conversations.length === 0 ? <div className=\"text-sm text-gray-500\">No conversations yet. Request a book to start a private chat.</div> : (\r\n            <div className=\"space-y-2\">\r\n              {conversations.map(c => (\r\n                <button key={c.id} onClick={() => onSelectConversation && onSelectConversation(c.id)} className=\"w-full text-left p-3 border rounded hover:bg-gray-50 flex items-center justify-between\">\r\n                  <div className=\"text-left\">\r\n                    <div className=\"text-sm font-medium\">Conversation about {c.bookId ? `book:${c.bookId}` : 'general'}</div>\r\n                    <div className=\"text-xs text-gray-500\">With: { (c.participantsInfo || c.participants).map(p => p.name || p).filter(Boolean).join(', ') }</div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {c.unreadCount ? <div className=\"bg-emerald-600 text-white text-xs px-2 py-1 rounded-full\">{c.unreadCount}</div> : null}\r\n                    <ArrowRight className=\"w-4 h-4 text-gray-400\" />\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"chat-glass p-4 rounded shadow h-[55vh] flex flex-col\">\r\n        <div className=\"flex-1 overflow-auto mb-4\">\r\n          {messages.map(m => (\r\n            <div key={m.id} className=\"mb-3\">\r\n              <div className=\"text-xs text-gray-500\">{m.fromName || m.from}  {new Date(m.createdAt).toLocaleTimeString()}</div>\r\n              <div className=\"bg-gray-100 inline-block p-2 rounded mt-1\">{m.text}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <input value={text} onChange={e=>setText(e.target.value)} className=\"flex-1 p-2 border rounded\" placeholder={user ? (conversationId ? 'Message the other participant...' : 'Write a public message...') : 'Sign in to chat'} disabled={!user} />\r\n          <button onClick={send} className=\"bg-emerald-600 text-white px-4 py-2 rounded\" disabled={!user}>Send</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Profile({ user, onUpdate, token }) {\r\n  const [name, setName] = useState(user?.name || '');\r\n  const [bio, setBio] = useState(user?.bio || '');\r\n  const save = async () => {\r\n    try {\r\n      if (!token) return;\r\n      const res = await fetch(`/api/users/${user.id}`, { method: 'PUT', headers: { 'Content-Type':'application/json', Authorization: `Bearer ${token}` }, body: JSON.stringify({ name, bio }) });\r\n      const data = await res.json();\r\n      if (res.ok) {\r\n        onUpdate(data);\r\n        showNotification('Profile updated', 'success');\r\n      } else {\r\n        showNotification(data.error || 'Failed to update profile', 'error');\r\n      }\r\n    } catch (e) { console.error(e); showNotification('Failed to update profile', 'error'); }\r\n  };\r\n  return (\r\n    <div className=\"max-w-md mx-auto px-4 py-12\">\r\n      <div className=\"bg-white p-8 rounded shadow\">\r\n        <h2 className=\"text-xl font-bold mb-4\">Profile</h2>\r\n        <input className=\"w-full mb-2 p-2 border rounded\" value={name} onChange={e=>setName(e.target.value)} />\r\n        <textarea className=\"w-full mb-2 p-2 border rounded\" value={bio} onChange={e=>setBio(e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={save} className=\"bg-emerald-600 text-white px-4 py-2 rounded\">Save</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Exchanges({ user, token, exchanges, refresh, onOpenConversation }) {\r\n  const accept = async (id) => {\r\n    if (!token) return;\r\n    try {\r\n      const r = await fetch(`/api/exchanges/${id}/accept`, { method: 'PUT', headers: { Authorization: `Bearer ${token}` } });\r\n      const d = await r.json();\r\n      if (r.ok) { refresh(); alert('Exchange accepted'); }\r\n      else alert(d.error || 'Failed');\r\n    } catch (e) { console.error(e); alert('Failed'); }\r\n  };\r\n  const decline = async (id) => {\r\n    if (!token) return;\r\n    try {\r\n      const r = await fetch(`/api/exchanges/${id}/decline`, { method: 'PUT', headers: { Authorization: `Bearer ${token}` } });\r\n      const d = await r.json();\r\n      if (r.ok) { refresh(); alert('Exchange declined'); }\r\n      else alert(d.error || 'Failed');\r\n    } catch (e) { console.error(e); alert('Failed'); }\r\n  };\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto px-4 py-8\">\r\n      <h2 className=\"text-2xl font-bold mb-4\">Exchange Requests</h2>\r\n      {exchanges.length === 0 ? <div className=\"text-gray-500\">No exchange activity.</div> : (\r\n        <div className=\"space-y-4\">\r\n          {exchanges.map(e => (\r\n            <div key={e.id} className=\"bg-white border p-4 rounded flex justify-between items-start\">\r\n              <div>\r\n                <div className=\"text-sm text-gray-500\">Book: {e.bookId}</div>\r\n                <div className=\"font-medium\">From: {e.requesterId}  Status: <span className=\"font-semibold\">{e.status}</span></div>\r\n                <div className=\"text-sm text-gray-600 mt-2\">{e.message}</div>\r\n                <div className=\"text-xs text-gray-400 mt-2\">Requested at: {new Date(e.createdAt).toLocaleString()}</div>\r\n              </div>\r\n              <div className=\"flex flex-col gap-2\">\r\n                {e.ownerId === user?.id && e.status === 'requested' ? (\r\n                  <>\r\n                    <button onClick={() => accept(e.id)} className=\"px-3 py-2 bg-emerald-600 text-white rounded\">Accept</button>\r\n                    <button onClick={() => decline(e.id)} className=\"px-3 py-2 border rounded\">Decline</button>\r\n                  </>\r\n                ) : null}\r\n                <button onClick={() => onOpenConversation && onOpenConversation(e.conversationId || e.conversation?.id)} className=\"px-3 py-2 bg-gray-100 rounded\">Open Chat</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}